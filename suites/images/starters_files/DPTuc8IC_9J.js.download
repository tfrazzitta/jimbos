if (self.CavalryLogger) { CavalryLogger.start_js(["a5YNr"]); }

__d("MStoriesBottomSheetController",["cx","CSS","DOM","MStoriesStratcomEvents","Run","Stratcom","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h="_7q7v";a=function(){__p&&__p();function a(){var a=this;this.$1=null;this.$4=function(){a.$2.forEach(function(a){return a.remove()})};this.$2=[b("Stratcom").listen(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null,function(){return a.$3()})];b("Run").onLeave(this.$4)}var c=a.prototype;c.setContainer=function(a){this.$1=a};c.$5=function(){return b("nullthrows")(this.$1)};c.showBottomSheet=function(a){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER),b("CSS").removeClass(this.$5(),h),b("DOM").setContent(this.$5(),a)};c.$3=function(){b("CSS").hasClass(this.$5(),h)||b("CSS").addClass(this.$5(),h)};return a}();e.exports=new a()}),null);
__d("WebGraphQLLegacyHelper",["invariant"],(function(a,b,c,d,e,f,g){"use strict";e.exports={getURI:function(a){var b=a.controller,c=a.docID,d=a.queryID;a=a.variables;c!=d&&(c||d)!=null||g(0,5819,c,d);b=b.getURIBuilder();d?b.setFBID("query_id",d):b.setFBID("doc_id",c);a&&b.setString("variables",JSON.stringify(a));return b.getURI()}}}),null);
__d("XWebGraphQLMutationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/webgraphql/mutation/",{query_id:{type:"FBID"},variables:{type:"String"},doc_id:{type:"FBID"}})}),null);
__d("base62",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function a(a){if(!a)return"0";var b="";while(a>0)b=g[a%62]+b,a=Math.floor(a/62);return b}e.exports=a}),null);
__d("WebGraphQLMutationBase",["invariant","CurrentUser","WebGraphQLLegacyHelper","XWebGraphQLMutationController","base62"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=0;a=function(){__p&&__p();function a(a){this.$1=a}var c=a.prototype;c.__getVariables=function(){return this.$1};c.__getDocID=function(){return this.constructor.__getDocID()};a.__getController=function(){return b("XWebGraphQLMutationController")};a.__getDocID=function(){g(0,1804)};a.getURI=function(a){return b("WebGraphQLLegacyHelper").getURI({controller:this.__getController(),docID:this.__getDocID(),variables:{data:babelHelpers["extends"]({client_mutation_id:b("base62")(h++),actor_id:b("CurrentUser").getID()},a)}})};return a}();e.exports=a}),null);
__d("CameraPostDirectMarkSeenMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1644150182303893"};b.getQueryID=function(){return"171816796723339"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("CameraPostReplyMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1459763854077111"};b.getQueryID=function(){return"1849675045338105"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("FBStoriesAudienceModeMutationCallMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1883080631763254"};b.getQueryID=function(){return"196508534442477"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("FBStoriesDeleteMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1340045906066120"};b.getQueryID=function(){return"967072946766012"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("FBStoriesLoggingConstants",[],(function(a,b,c,d,e,f){"use strict";a={EVENT_STORY:"event",FOLLOWEE_STORY:"followee",FRIEND_STORY:"friend",GROUP_STORY:"group",MISSING_STORY_DATA:"missingStoryData",PAGE_STORY:"page",SELF_STORY:"self",STORY_PROMOTION:"promotion",ACTION_OPEN_MEDIA:"open_media",ACTION_DELETE_MEDIA:"delete_media_attempted",ACTION_SEND_REPLY_ATTEMPT:"attempt_to_send_reply",ACTION_SEND_REPLY_SUCCESS:"mark_reply_sent",ACTION_SEND_REPLY_FAILURE:"reply_sent_failure",ACTION_SEND_STICKER_ATTEMPT:"attempt_to_send_sticker",ACTION_SEND_STICKER_SUCCESS:"mark_sticker_sent",ACTION_SEND_STICKER_FAILURE:"sticker_sent_failure",ACTION_SEND_GIF_ATTEMPT:"attempt_to_send_gif",ACTION_SEND_GIF_SUCCESS:"mark_gif_sent",ACTION_SEND_GIF_FAILURE:"gif_sent_failure",ACTION_SEND_REACTION_ATTEMPT:"attempt_to_send_reaction",ACTION_SEND_REACTION_SUCCESS:"mark_reaction_sent",ACTION_SEND_REACTION_FAILURE:"reaction_sent_failure",ACTION_OPEN_SEEN_SUMMARY:"open_seen_summary",ACTION_OPEN_STORY:"open_story",ACTION_CLOSE_STORY:"close_story",ACTION_TRAY_LOAD:"story_tray_load",ACTION_SEND_STORY_FAILED:"send_story_failed",ACTION_SEND_STORY_SUCCEEDED:"send_story_succeed",ACTION_STORY_NAVIGATION:"story_navigation",INTERACTION_TAP_RESHARED_STORY:"reshared_story_tap",INTERACTION_TAP_RESHARED_TOOLTIP:"reshared_story_view_story_tap",GESTURES:{CLOSE_STORY:{CLICK_RIGHT:"click_right",CLICK_LEFT:"click_left",AUTO_JUMP:"auto_jump",AUTO_EXIT:"auto_exit",CLICK_EXIT:"click_exit",SWIPE_RIGHT:"swipe_right",SWIPE_LEFT:"swipe_left",SWIPE_EXIT:"swipe_exit",SWIPE_DOWN_EXIT:"swipe_down_exit",CLOSE_BUTTON_EXIT:"close_button_exit",BACK_BUTTON_EXIT:"back_button_exit"}},SOURCE_CLOSE_FROM_MODAL:"closeFromClickingOnModal",SOURCE_CLOSE_FROM_MODAL_CLOSE_BUTTON:"closeFromClickingOnModalCloseButton",SOURCE_CLOSE_FROM_LAST_STORY_FINISHING:"closeFromLastStoryFinishing",SOURCES:{ARCHIVE:"archive",POST_HEADER:"post_header_actor_photo",STORY_TRAY:"story_tray",UNKNOWN:"unknown"}};e.exports=a}),null);
__d("FBStoriesMuteMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1524574307634402"};b.getQueryID=function(){return"1944151819168048"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("FBStoriesUnifiedSeenReceiptLastSeenTimeMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1530421027083413"};b.getQueryID=function(){return"213614895981437"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("FBStoriesVotePollMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1942364135805651"};b.getQueryID=function(){return"1772533953042568"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("ReactionStickerStoryCardReactMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1651380361616532"};b.getQueryID=function(){return"603085890111081"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("StoriesArchiveDeletionMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"997271687064551"};b.getQueryID=function(){return"2146552195626815"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("UnifiedStoriesArchiveSavingModeMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"2879905198698528"};b.getQueryID=function(){return"240974536483368"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("XGraphQLBatchAPIController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/api/graphqlbatch/",{queries:{type:"String"},batch_name:{type:"String"},scheduler:{type:"Enum",enumType:1},shared_params:{type:"String"},fb_api_req_friendly_name:{type:"String"},uft_request_id:{type:"String"}})}),null);
__d("WebGraphQL-core",["ActorURI","Deferred","FBLogger","WebGraphQLConfig","XGraphQLBatchAPIController","XHRRequest","createChunkedResponseParser","getAsyncParams","getSameOriginTransport"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){__p&&__p();var c=a.getURIBuilder().getURI(),d={exec:function(a,b){return d.execAll([a],b)[0]},execAll:function(a,d){__p&&__p();var e={},f={};a=a.map(function(a,c){c="o"+c;e[c]={doc_id:a.__getDocID(),query_params:a.__getVariables()};a=new(b("Deferred"))();f[c]=a;return a.getPromise()});var g=babelHelpers["extends"]({},b("getAsyncParams")("POST"));d&&d.actorID!=null&&(g[b("ActorURI").PARAMETER_ACTOR]=d.actorID);d=d&&d.batchName?{batch_name:d.batchName}:{};d=new(b("XHRRequest"))(c).setMethod("POST").setTransportBuilder(b("getSameOriginTransport")).setRequestHeader("Content-Type","application/x-www-form-urlencoded").setData(babelHelpers["extends"]({},d,g,{queries:JSON.stringify(e)})).setResponseHandler(b("createChunkedResponseParser")(function(a,c,d){__p&&__p();try{var e=JSON.parse(a);Object.keys(e).forEach(function(a){var b=f[a];if(b){a=e[a];a.errors?b.reject(a):a.data?b.resolve(a.data):b.reject({data:{},errors:[{message:"Unexpected response received from server.",severity:"CRITICAL",response:a}]})}})}catch(c){b("FBLogger")("webgraphql").catching(c).mustfix("Bad response: %s%s",a.substr(0,250),a.length>250?"[truncated]":"")}d&&Object.keys(f).forEach(function(a){f[a].isSettled()||f[a].reject({data:{},errors:[{message:"No response received from server.",severity:"CRITICAL"}]})})})).setTimeout(b("WebGraphQLConfig").timeout).setTimeoutHandler(function(){Object.keys(f).forEach(function(a){f[a].isSettled()||f[a].reject({data:{},errors:[{message:"Request timed out.",severity:"CRITICAL"}]})})}).setErrorHandler(function(a){Object.keys(f).forEach(function(b){f[b].isSettled()||f[b].reject({data:{},errors:[{message:a&&a.message||"Transport error.",severity:"CRITICAL",error:a}]})}),a instanceof Error?b("FBLogger")("webgraphql").catching(a).mustfix("WebGraphQL error"):b("FBLogger")("webgraphql").mustfix("Unknown WebGraphQL error")});d.send();return a},__forController:g};return d}e.exports=g(b("XGraphQLBatchAPIController"))}),null);
__d("WebGraphQL",["WebGraphQL-core"],(function(a,b,c,d,e,f){e.exports=b("WebGraphQL-core")}),null);
__d("MStoriesMutationAPIs",["Promise","Bootloader","CameraPostDirectMarkSeenMutationWebGraphQLMutation","CameraPostReplyMutationWebGraphQLMutation","CurrentUser","FBLogger","FBStoriesAudienceModeMutationCallMutationWebGraphQLMutation","FBStoriesDeleteMutationWebGraphQLMutation","FBStoriesLoggingConstants","FBStoriesMuteMutationWebGraphQLMutation","FBStoriesUnifiedSeenReceiptLastSeenTimeMutationWebGraphQLMutation","FBStoriesVotePollMutationWebGraphQLMutation","ReactionStickerStoryCardReactMutationWebGraphQLMutation","StoriesArchiveDeletionMutationWebGraphQLMutation","UnifiedStoriesArchiveSavingModeMutationWebGraphQLMutation","WebGraphQL","uuid"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="LIGHT_WEIGHT",h=function(a,c){__p&&__p();c=(c==null?void 0:c.errors)||[];c.forEach(function(d){var c=d==null?void 0:d.error;if(c instanceof Error)b("FBLogger")("fbstories").catching(c).mustfix(a);else{c=JSON.stringify(c);c==null&&(c=JSON.stringify(d));c&&c.length>500&&(c=c.substr(0,500));b("FBLogger")("fbstories").mustfix(a+" "+c)}})};e.exports={deleteThread:function(a){return b("WebGraphQL").exec(new(b("FBStoriesDeleteMutationWebGraphQLMutation"))({input:{client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),story_thread_ids:[a]}})).then(function(a){return a},function(a){h("Error deleting thread",a);return b("Promise").reject(a)})},deleteArchivedStoryCard:function(a){return b("WebGraphQL").exec(new(b("StoriesArchiveDeletionMutationWebGraphQLMutation"))({input:{client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),archived_story_card_id:a}}))},muteStoryOwner:function(a){return b("WebGraphQL").exec(new(b("FBStoriesMuteMutationWebGraphQLMutation"))({input:{client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),user_id:a,should_unfollow_user_story:!0}}))},unmuteStoryOwner:function(a){return b("WebGraphQL").exec(new(b("FBStoriesMuteMutationWebGraphQLMutation"))({input:{client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),user_id:a,should_unfollow_user_story:!1}}))},sendMessage:function(a,c,d,e,f){__p&&__p();b("Bootloader").loadModules(["MStoriesTypedLogger"],function(g){g=new g().setCameraPostType(d).setName(b("FBStoriesLoggingConstants").ACTION_SEND_REPLY_ATTEMPT).setReplyType(f).setCardID(a);if(c){var h=c.length;g.setMessageLength(h)}e&&g.setStoryOwner(e);g.log()},"MStoriesMutationAPIs");var g={client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),thread_id:a,message:c};return b("WebGraphQL").exec(new(b("CameraPostReplyMutationWebGraphQLMutation"))({input:g})).then(function(c){b("Bootloader").loadModules(["MStoriesTypedLogger"],function(c){new c().setCameraPostType(d).setName(b("FBStoriesLoggingConstants").ACTION_SEND_REPLY_SUCCESS).setStoryOwner(e).setReplyType(f).setCardID(a).log()},"MStoriesMutationAPIs");return c},function(c){h("Error sending message",c);b("Bootloader").loadModules(["MStoriesTypedLogger"],function(c){new c().setCameraPostType(d).setName(b("FBStoriesLoggingConstants").ACTION_SEND_REPLY_FAILURE).setStoryOwner(e).setReplyType(f).setCardID(a).log()},"MStoriesMutationAPIs");return b("Promise").reject(c)})},sendLightweightReaction:function(a,c,d,e,f){__p&&__p();var i="light_weight";b("Bootloader").loadModules(["MStoriesTypedLogger"],function(e){e=new e().setCameraPostType(c).setName(b("FBStoriesLoggingConstants").ACTION_SEND_REACTION_ATTEMPT).setReplyType(i).setCardID(a);d&&e.setStoryOwner(d);e.log()},"MStoriesMutationAPIs");e={client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),thread_id:a,message:e,story_reply_type:g,is_lightweight_reaction:!0,lightweight_reaction_actions:{reaction:e,offsets:[f||0]}};return b("WebGraphQL").exec(new(b("CameraPostReplyMutationWebGraphQLMutation"))({input:e})).then(function(e){b("Bootloader").loadModules(["MStoriesTypedLogger"],function(e){new e().setCameraPostType(c).setName(b("FBStoriesLoggingConstants").ACTION_SEND_REACTION_SUCCESS).setStoryOwner(d).setReplyType(i).setCardID(a).log()},"MStoriesMutationAPIs");return e},function(e){h("Error sending message",e);b("Bootloader").loadModules(["MStoriesTypedLogger"],function(e){new e().setCameraPostType(c).setName(b("FBStoriesLoggingConstants").ACTION_SEND_REACTION_FAILURE).setStoryOwner(d).setReplyType(i).setCardID(a).log()},"MStoriesMutationAPIs");return e})},markThreadSeen:function(a,c){a={client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),thread_id:a,story_id:c};return b("WebGraphQL").exec(new(b("CameraPostDirectMarkSeenMutationWebGraphQLMutation"))({input:a}))},changeAudienceMode:function(a){return b("WebGraphQL").exec(new(b("FBStoriesAudienceModeMutationCallMutationWebGraphQLMutation"))({input:{client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),audience_mode:a}}))},updateArchiveSavingMode:function(a){return b("WebGraphQL").exec(new(b("UnifiedStoriesArchiveSavingModeMutationWebGraphQLMutation"))({saving_mode:{client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),saving_mode:a}}))},updatePollVotesForOption:function(a,c){return b("WebGraphQL").exec(new(b("FBStoriesVotePollMutationWebGraphQLMutation"))({input:{client_mutation_id:b("uuid")(),story_card_poll_id:a,option:c,actor_id:b("CurrentUser").getID()}}))},reactToSticker:function(a,c){return b("WebGraphQL").exec(new(b("ReactionStickerStoryCardReactMutationWebGraphQLMutation"))({input:{client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),story_card_reaction_sticker_id:a,count:c}}))},updateStorySeenReciept:function(a){a={client_mutation_id:b("uuid")(),actor_id:b("CurrentUser").getID(),story_id:a};return b("WebGraphQL").exec(new(b("FBStoriesUnifiedSeenReceiptLastSeenTimeMutationWebGraphQLMutation"))({input:a}))}}}),null);
__d("MStoriesViewerAnchor",["CSS","MFBStoriesSigil","MStoriesGating","MStoriesID","MStoriesMutationAPIs","MStoriesStratcomEvents","Run","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();a.init=function(c){var d=a.getInstance();d.$2=!1;d.$3=c.storyID;d.$4=document.getElementById(b("MStoriesID").VIEWER_ANCHOR);this.$1=d};a.getInstance=function(){this.$1||(this.$1=new a());return this.$1};function a(){__p&&__p();var c=this;this.$2=!1;this.$3=null;this.$4=null;this.$7=function(){c.$5.forEach(function(a){return a.remove()}),c.$5=[],a.$1=null,a.loading=!1};this.$5=[b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_SEEN_SUMMARY_ANCHOR,function(c){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null);b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE,null);if(b("MStoriesGating").shouldShowNTViewerSheet()){if(a.loading)return;b("Stratcom").invoke(b("MStoriesStratcomEvents").CLICK_STORY_IN_VIEWER_SHEET)}}),b("Stratcom").listen(b("MStoriesStratcomEvents").VIEWER_SHEET_HIDE,null,function(a){c.$6(a)}),b("Stratcom").listen(b("MStoriesStratcomEvents").VIEWER_SHEET_OPEN,null,function(){c.$4&&c.$4.click()})];b("Run").onLeave(this.$7)}var c=a.prototype;c.$6=function(a){this.$2||(this.$2=!0,this.$3!=null&&b("MStoriesMutationAPIs").updateStorySeenReciept(this.$3),this.$4&&b("CSS").removeClass(this.$4,"highlighted"))};return a}();a.$1=null;a.loading=!1;e.exports=a}),null);
__d("MStoriesDisplayUtils",["cx","CSS","DOM","MStoriesID","MStoriesViewerAnchor"],(function(a,b,c,d,e,f,g){"use strict";var h={toggleChromeBar:function(a,c){c||(c=document.getElementsByClassName("_129-")[0]),c&&(a?b("DOM").show(c):b("DOM").hide(c)),h.toggleSoftKeyTray(a)},toggleSoftKeyTray:function(a){var c=document.getElementById("kaios_tray");c&&(a?b("DOM").show(c):b("DOM").hide(c))},toggleLoadingScreen:function(a,c){var d=document.getElementById(b("MStoriesID").LOADING_SCREEN);d&&(a?(b("MStoriesViewerAnchor").loading=!0,b("CSS").removeClass(d,"hidden_elem"),c&&b("CSS").addClass(d,"full_loading_screen")):(b("MStoriesViewerAnchor").loading=!1,b("CSS").addClass(d,"hidden_elem"),c&&b("CSS").removeClass(d,"full_loading_screen")))}};e.exports=h}),null);
__d("CloseStoryGesture",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=Object.freeze({CLICK_RIGHT:"click_right",CLICK_LEFT:"click_left",AUTO_JUMP:"auto_jump",AUTO_EXIT:"auto_exit",CLICK_EXIT:"click_exit",SWIPE_RIGHT:"swipe_right",SWIPE_LEFT:"swipe_left",SWIPE_EXIT:"swipe_exit",SWIPE_DOWN_EXIT:"swipe_down_exit",CLOSE_BUTTON_EXIT:"close_button_exit",BACK_BUTTON_EXIT:"back_button_exit",isExitGesture:function(a){switch(a){case"click_right":case"click_left":case"auto_jump":case"swipe_right":case"swipe_left":return!1;case"swipe_exit":case"auto_exit":case"click_exit":case"swipe_down_exit":case"close_button_exit":case"back_button_exit":return!0}return!1},fromString:function(a){if(!a)return null;switch(a){case"click_right":case"click_left":case"auto_jump":case"auto_exit":case"click_exit":case"swipe_right":case"swipe_left":case"swipe_exit":case"swipe_down_exit":case"close_button_exit":case"back_button_exit":return a;default:return null}}})}),null);
__d("MStoriesSessionInfo",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={_source:null,_traySessionID:null,_viewerSessionID:null,_feedUnitTrackingString:null,setViewerSessionID:function(a){this._viewerSessionID=a},getViewerSessionID:function(){return this._viewerSessionID},setTraySessionID:function(a){this._traySessionID=a},getTraySessionID:function(){return this._traySessionID},setSource:function(a){this._source=a},getSource:function(){return this._source},setFeedUnitTrackingString:function(a){this._feedUnitTrackingString=a},getFeedUnitTrackingString:function(){return this._feedUnitTrackingString}};e.exports=a}),null);
__d("MStoriesLoggingUtils",["Banzai","BanzaiLogger","CloseStoryGesture","FBStoriesLoggingConstants","MStoriesSessionInfo","requireCond","cr:710451"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=!1;function h(a,c,d){return{extra_client_data:JSON.stringify({story_size:c.number_of_media}),gesture:d,name:a,number_media:c==null?void 0:c.number_of_media,media_index:c==null?void 0:c.media_index,media_type:c.media_type,story_owner:c.owner_id,story_owner_type:c.owner_type,tray_session_id:b("MStoriesSessionInfo").getTraySessionID(),viewer_session_id:b("MStoriesSessionInfo").getViewerSessionID(),client_viewer_session_id:b("MStoriesSessionInfo").getViewerSessionID(),card_id:c.thread_id,thread_id:c.thread_id,source:b("MStoriesSessionInfo").getSource(),product_surface:"mtouch",stories_tray_feed_unit_tracking_string:b("MStoriesSessionInfo").getFeedUnitTrackingString()}}e.exports={resetCanLogCloseStoryExit:function(){g=!1},logStoryNavigation:function(a,c,d){d===void 0&&(d={});a=h(b("FBStoriesLoggingConstants").ACTION_STORY_NAVIGATION,a,c);a=babelHelpers["extends"]({},d,a);b("BanzaiLogger").log("DirectMessagingLoggerConfig",a);b("Banzai").post("fb_stories_insights_logging_banzai",a)},logCloseStory:function(a,c,d){d===void 0&&(d={});if(g&&b("CloseStoryGesture").isExitGesture(c))return;a=h(b("FBStoriesLoggingConstants").ACTION_CLOSE_STORY,a,c);a=babelHelpers["extends"]({},d,a);b("BanzaiLogger").log("DirectMessagingLoggerConfig",a);b("Banzai").post("fb_stories_insights_logging_banzai",a);b("CloseStoryGesture").isExitGesture(c)&&(g=!0)},log:function(a){a.source==="in_feed"&&a.stories_tray_feed_unit_tracking_string==null&&(a.stories_tray_feed_unit_tracking_string=b("MStoriesSessionInfo").getFeedUnitTrackingString()),b("BanzaiLogger").log("DirectMessagingLoggerConfig",a)}}}),null);
__d("MStoriesOptimisticInfo",["MFBStoriesGatingConfig","MFBStoriesTrayType","MStoriesUploadStatus","Style","uniqueID"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="30vw",h="40vw",i="86px",j="128px",k="o-",l={_previews:[],addUpload:function(a,c,d,e){a={canvas:a,creationTime:c,mediaType:d,mediaID:null,postType:e,seen:!1,status:b("MStoriesUploadStatus").UPLOADING,threadID:k+b("uniqueID")()};this._previews.push(a);return a},nonCompletedUploadCount:function(){return this._getNonCompletedUploads().length},getThreadIDs:function(a){return this._getNonCompletedUploads().filter(function(b){return b.mediaID==null||a==null||!a.includes(b.mediaID)}).map(function(a){return a.threadID})},isOptimisticThreadID:function(a){return a!=null&&a.startsWith(k)},removeCompletedUploads:function(){this._previews=this._getNonCompletedUploads()},_getNonCompletedUploads:function(){return this._previews.filter(function(a){return a.status!==b("MStoriesUploadStatus").IDLE})},getFirstUnseenUpload:function(){return this._getNonCompletedUploads().find(function(a){return!a.seen})},getFirstUpload:function(){var a=this._getNonCompletedUploads();return a.length>0?a[0]:null},getNextOptimisticUploadToViewInBucket:function(a){var b,c=l.getFirstUnseenUpload();c?b=c:a!==null&&a!==void 0&&(b=l.getUploadForThreadID(a));c=b?this.getIndexOfUpload(b):0;return{index:c,upload:b}},getIndexOfUpload:function(a){return this._getNonCompletedUploads().indexOf(a)},getUploadForThreadID:function(a){return this._previews.find(function(b){return b.threadID===a})},getCanvasForTray:function(a){b("Style").set(a.canvas,"object-fit","cover");b("MFBStoriesGatingConfig").trayType===b("MFBStoriesTrayType").MOBILE_THREE_BY_ONE?(b("Style").set(a.canvas,"width",g),b("Style").set(a.canvas,"height",h)):(b("Style").set(a.canvas,"width",i),b("Style").set(a.canvas,"height",j));return a.canvas},getCanvasForViewer:function(a){b("Style").set(a.canvas,"width","100%");b("Style").set(a.canvas,"height","auto");return a.canvas},removeUpload:function(a){this._previews=this._previews.filter(function(b){return b.threadID!==a})},getMediaIDs:function(){return this._getNonCompletedUploads().map(function(a){return a.mediaID}).filter(function(a){return!!a})},markUploadSeen:function(a){a.seen=!0},unseenUploadCount:function(){return this._getNonCompletedUploads().filter(function(a){return!a.seen}).length}};e.exports=l}),null);
__d("MStoriesTrackableElements",["Stratcom","Style"],(function(a,b,c,d,e,f){"use strict";a={_elements:[],init:function(a){this._elements=a.elements},hideElementsAndInvokeLogging:function(){this._elements.map(function(a){return b("Style").set(a,"margin-top","-100px")}),b("Stratcom").invoke("m:stories:card-hidden",null,null)}};e.exports=a}),null);
__d("MStoriesViewerSheetThreadRelatedInfo",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={_currentThreadIndex:0,_currentNTIndex:-1,_maxThread:Number.MAX_VALUE,_deletedThreadIDs:[],setCurrentThreadIndex:function(a){this._currentThreadIndex=Math.min(a.currentThreadIndex,this._maxThread)},getCurrentThreadIndex:function(){return this._currentThreadIndex},setMaxThreadIndex:function(a){this._maxThread=a},getMaxThreadIndex:function(){return this._maxThread},addDeletedThreadIDs:function(a){this._deletedThreadIDs.push(a)},removeDeletedThreadIDs:function(a){this._deletedThreadIDs=this._deletedThreadIDs.filter(function(b){return b!==a})},getDeleteThreadIDs:function(){return this._deletedThreadIDs},getCurrentNTIndex:function(){return this._currentNTIndex},setCurrentNTIndex:function(a){this._currentNTIndex=a}};e.exports=a}),null);
__d("StoryNavigationGesture",["CloseStoryGesture"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=Object.freeze({TAP_FORWARD:"tap_forward",TAP_BACKWARD:"tap_backward",AUTO_JUMP:"auto_jump",SWIPE_RIGHT:"swipe_right",SWIPE_LEFT:"swipe_left",getCloseStoryGestureFromStoryNavigation:function(a,c){if(!a)return"nil";switch(a){case this.TAP_BACKWARD:return c?b("CloseStoryGesture").CLICK_EXIT:b("CloseStoryGesture").CLICK_LEFT;case this.TAP_FORWARD:return c?b("CloseStoryGesture").CLICK_EXIT:b("CloseStoryGesture").CLICK_RIGHT;case this.AUTO_JUMP:return c?b("CloseStoryGesture").AUTO_EXIT:b("CloseStoryGesture").AUTO_JUMP;case this.SWIPE_LEFT:return c?b("CloseStoryGesture").SWIPE_EXIT:b("CloseStoryGesture").SWIPE_LEFT;case this.SWIPE_RIGHT:return c?b("CloseStoryGesture").SWIPE_EXIT:b("CloseStoryGesture").SWIPE_RIGHT;default:return"nil"}}})}),null);
__d("StoryViewerType",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({ARCHIVE:"archive",HIGHLIGHT:"highlight",DIRECT:"direct",DEFAULT:"default"})}),null);
__d("XFBStoriesArchiveViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/archive/viewer/",{card_id:{type:"FBID",required:!0},should_expand_viewer_sheet:{type:"Bool",defaultValue:!1}})}),null);
__d("XMStoriesArchiveAsyncViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/archive/viewer/{card_id}/",{card_id:{type:"FBID",required:!0},card_index:{type:"Int",required:!0},card_count:{type:"Int"}})}),null);
__d("XMStoriesAsyncOptimisticUploadCardViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/optimistic_card/",{creation_time:{type:"Int",required:!0},media_type:{type:"Enum",required:!0,enumType:1},thread_id:{type:"String",required:!0},thread_index:{type:"Int",required:!0},thread_count:{type:"Int",required:!0}})}),null);
__d("XMStoriesAsyncThreadViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/card/{bucket_id}/{thread_id}/",{bucket_id:{type:"FBID",required:!0},bucket_index:{type:"Int",required:!0},prev_thread_id:{type:"FBID"},prev_thread_index:{type:"Int"},source:{type:"String"},thread_id:{type:"FBID",required:!0},thread_index:{type:"Int",required:!0},thread_count:{type:"Int"},tray_session_id:{type:"String"},viewer_session_id:{type:"String"},optimistically_deleted_thread_ids:{type:"FBIDVector"}})}),null);
__d("XMStoriesOptimisticUploadTrayViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/view_tray_upload/{selected_bucket_id}/",{optimistic_creation_time:{type:"Int",required:!0},optimistic_media_id:{type:"FBID"},optimistic_media_ids:{type:"FBIDVector"},optimistic_media_type:{type:"Enum",required:!0,enumType:1},optimistic_thread_index:{type:"Int",required:!0},optimistic_thread_id:{type:"String",required:!0},source:{type:"String"},selected_bucket_id:{type:"FBID",required:!0},selected_bucket_index:{type:"Int"},tray_session_id:{type:"String"},has_bucket_ids:{type:"Bool",defaultValue:!1},upload_count:{type:"Int",required:!0}})}),null);
__d("XMStoriesTrayPaginationViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/view_tray_pagination/{selected_bucket_id}/",{end_cursor:{type:"String"},has_bucket_ids:{type:"Bool",defaultValue:!1},has_next_page:{type:"Bool",defaultValue:!1},selected_bucket_id:{type:"FBID",required:!0},selected_bucket_index:{type:"Int"},thread_id:{type:"FBID"},tray_session_id:{type:"String"},source:{type:"String"},unseen:{type:"Bool",defaultValue:!1},feed_unit_id:{type:"String"},feed_unit_tracking_string:{type:"String"},should_expand_viewer_sheet:{type:"Bool",defaultValue:!1}})}),null);
__d("XMStoriesTrayViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/view_tray/{selected_bucket_id}/",{optimistic_media_ids:{type:"FBIDVector"},selected_bucket_id:{type:"FBID",required:!0},selected_bucket_index:{type:"Int"},thread_id:{type:"FBID"},tray_session_id:{type:"String"},viewer_session_id:{type:"String"},has_bucket_ids:{type:"Bool",defaultValue:!1},source:{type:"String"},unseen:{type:"Bool",defaultValue:!1},upload_count:{type:"Int"},feed_unit_id:{type:"String"},feed_unit_tracking_string:{type:"String"},should_expand_viewer_sheet:{type:"Bool",defaultValue:!1}})}),null);
__d("MStoriesBucketViewer",["cx","Bootloader","CSS","CurrentUser","MFBStoriesSigil","MHistory","MStoriesDisplayUtils","MStoriesGating","MStoriesLoggingUtils","MStoriesOptimisticInfo","MStoriesSessionInfo","MStoriesStratcomEvents","MStoriesTrackableElements","MStoriesTrayInfo","MStoriesUploadStatus","MStoriesViewerSheetThreadRelatedInfo","QuickPerformanceLogger","Run","StoriesQuickLogModule","StoryNavigationGesture","StoryViewerType","Stratcom","URI","XAsyncRequest","XFBStoriesArchiveViewerController","XMStoriesArchiveAsyncViewerController","XMStoriesAsyncOptimisticUploadCardViewerController","XMStoriesAsyncThreadViewerController","XMStoriesOptimisticUploadTrayViewerController","XMStoriesTrayPaginationViewerController","XMStoriesTrayViewerController","gkx","goURI"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(){__p&&__p();function a(){__p&&__p();var a=this;this.$12=null;this.$13=b("StoryViewerType").DEFAULT;this.$21=function(c){var d=new(b("URI"))(c.getData().path);d=d.getPath();if(d.startsWith("/stories/view_tray")||d.startsWith("/stories/archive/viewer")||d.startsWith("/direct")){c.prevent();return}b("MStoriesTrackableElements").hideElementsAndInvokeLogging();b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE);d.startsWith("/stories/settings")||d.startsWith("/stories/preview")||d.startsWith("/archive/")?a.$12=null:!a.$12&&!b("gkx")("709647")&&(c.prevent(),b("goURI")(d))};this.$24=function(){if(!b("MStoriesGating").shouldShowNTViewerSheet())return;a.$14=!0;a.$28(!0)};this.$19=function(){a.$8.splice(a.$7,1),b("MStoriesViewerSheetThreadRelatedInfo").setMaxThreadIndex(a.$8.length-1),a.$7<a.$8.length?(a.$7--,a.$18(b("StoryNavigationGesture").AUTO_JUMP)):a.$8.length===0?a.$20(!1):(a.$7--,a.$29(),b("Stratcom").invoke(b("MStoriesStratcomEvents").NEXT_BUCKET,null,{gesture:b("StoryNavigationGesture").AUTO_JUMP}))};this.$23=function(){__p&&__p();if(!b("MStoriesGating").shouldShowNTViewerSheet())return;a.$14=!1;var c=b("MStoriesViewerSheetThreadRelatedInfo").getCurrentThreadIndex();if(c===a.$7){a.$28(!0);return}b("Stratcom").invoke(b("MStoriesStratcomEvents").CARD_CHANGED_BY_VIEWER_SHEET);a.$31(c)};this.$12=document.getElementsByClassName("_129-")[0];b("MStoriesDisplayUtils").toggleChromeBar(!1,this.$12);this.$9=[b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_PREV_BUCKET_BUTTON,function(){a.$17(b("StoryNavigationGesture").TAP_BACKWARD)}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_NEXT_BUCKET_BUTTON,function(){a.$18(b("StoryNavigationGesture").TAP_FORWARD)}),b("Stratcom").listen(b("MStoriesStratcomEvents").NEXT_CARD,null,function(){a.$18(b("StoryNavigationGesture").AUTO_JUMP)}),b("Stratcom").listen(b("MStoriesStratcomEvents").DELETE_THREAD,null,this.$19),b("Stratcom").listen("click",b("MFBStoriesSigil").EMPTY_BUCKET_CONFIRM_BUTTON,function(){a.$20(!1)}),b("Stratcom").listen("click",b("MFBStoriesSigil").EMPTY_BUCKET_CONFIRM_BACKWARDS_BUTTON,function(){a.$20(!0)}),b("Stratcom").listen("m:history:change",null,this.$21),b("Stratcom").listen(b("MStoriesStratcomEvents").UPLOAD_SUCCESS,null,function(b){b=b.getData()||{};a.$22(b.newThreadID,b.optimisticThreadID)}),b("Stratcom").listen(b("MStoriesStratcomEvents").VIEWER_SHEET_HIDDEN,null,this.$23),b("Stratcom").listen(b("MStoriesStratcomEvents").CLICK_STORY_IN_VIEWER_SHEET,null,this.$24)];this.$10={};this.$11={};b("Run").onLeave(function(){a.$25()})}a.getInstance=function(){this.$16||(this.$16=new a());return this.$16};a.isArchiveStoryViewer=function(){return a.getInstance().$13===b("StoryViewerType").ARCHIVE};a.init=function(b){var c=b.bucketID,d=b.startingThreadIndex,e=b.threadIDs,f=b.bucketIndex,g=b.mediaType,h=b.ownerID,i=b.ownerType,j=b.storyViewerType,k=b.navigationRoot,l=b.serverThreadMediaIDs;b=b.shouldShowViewerSheet;a.getInstance().$26(c,f,d,e,g,h,i,j,k,l,b)};var c=a.prototype;c.$26=function(a,c,d,e,f,g,h,i,j,k,l){this.$1=a,this.$2=c,this.$8=e,this.$7=d,this.$4=f,this.$5=g,this.$6=h,i&&(this.$13=i),b("MStoriesGating").shouldShowNTViewerSheet()&&(this.$14=l,b("MStoriesViewerSheetThreadRelatedInfo").setMaxThreadIndex(this.$8.length-1)),this.$15=j,b("MStoriesGating").shouldShowOptimisticPreviews()&&this.$5===b("CurrentUser").getID()&&(this.$8=this.$8.concat(b("MStoriesOptimisticInfo").getThreadIDs(k))),this.$27(),this.$7<this.$8.length&&this.$28(!1),this.$3&&(this.$3.abort(),this.$3=null),this.$29(),b("MStoriesTrayInfo").setTrayNeedsRefresh(!0)};c.$27=function(){var a=this.$15;if(a===null||a===void 0)return;b("CSS").removeClass(a,"prevDisabled");b("CSS").removeClass(a,"nextDisabled");var c=b("gkx")("709647");if(c)return;this.$13===b("StoryViewerType").ARCHIVE?(this.$7===0&&b("CSS").addClass(a,"prevDisabled"),this.$7===this.$8.length-1&&b("CSS").addClass(a,"nextDisabled")):this.$2===0&&this.$7===0&&b("CSS").addClass(a,"prevDisabled")};c.$28=function(a){__p&&__p();var c=b("MStoriesSessionInfo").getTraySessionID(),d=-1;a?d=b("MStoriesViewerSheetThreadRelatedInfo").getCurrentThreadIndex():d=this.$7;if(this.$13===b("StoryViewerType").ARCHIVE){a=b("XFBStoriesArchiveViewerController").getURIBuilder().setFBID("card_id",this.$8[d]).setBool("should_expand_viewer_sheet",this.$14).getURI();b("MHistory").replaceState(a);return}if(c){a=this.$8[d];var e;if(b("MStoriesOptimisticInfo").isOptimisticThreadID(a)){a=b("MStoriesOptimisticInfo").getUploadForThreadID(a);a&&a.status===b("MStoriesUploadStatus").UPLOADING&&(e=b("XMStoriesOptimisticUploadTrayViewerController").getURIBuilder().setFBID("selected_bucket_id",this.$1).setString("tray_session_id",c).setFBID("optimistic_media_id",a.mediaID).setEnum("optimistic_media_type",a.mediaType).setInt("optimistic_creation_time",a.creationTime).setInt("optimistic_thread_index",this.$7).setString("optimistic_thread_id",a.threadID).setInt("upload_count",b("MStoriesOptimisticInfo").nonCompletedUploadCount()).setFBIDVector("optimistic_media_ids",b("MStoriesOptimisticInfo").getMediaIDs()).getURI())}else{a=new(b("URI"))(b("MHistory").getPath());var f=a.getQueryData(),g=a.getPath();g.startsWith("/direct")?(f.bucket_id=this.$1,a.setQueryData(f),a.setPath("/direct/"+this.$8[d]),e=a):g.startsWith("/stories/view_tray_pagination")?e=b("XMStoriesTrayPaginationViewerController").getURIBuilder().setFBID("selected_bucket_id",this.$1).setString("tray_session_id",c).setFBID("thread_id",this.$8[d]).setString("feed_unit_tracking_string",b("MStoriesSessionInfo").getFeedUnitTrackingString()).setBool("should_expand_viewer_sheet",this.$14).setString("end_cursor",f.end_cursor).setBool("has_next_page",f.has_next_page==="1").getURI():e=b("XMStoriesTrayViewerController").getURIBuilder().setFBID("selected_bucket_id",this.$1).setString("tray_session_id",c).setFBID("thread_id",this.$8[d]).setString("feed_unit_tracking_string",b("MStoriesSessionInfo").getFeedUnitTrackingString()).setBool("should_expand_viewer_sheet",this.$14).getURI()}b("MHistory").replaceState(e)}};c.$29=function(){var a=this.$8[this.$7];if(b("MStoriesOptimisticInfo").isOptimisticThreadID(a)){this.$11[this.$1]=a;var c=b("MStoriesOptimisticInfo").getUploadForThreadID(a);c&&b("MStoriesOptimisticInfo").markUploadSeen(c)}else this.$10[this.$1]=a};c.$20=function(a){delete this.$10[this.$1],b("Stratcom").invoke(b("MStoriesStratcomEvents").DELETE_BUCKET,null,{backwards:a})};c.$17=function(a){if(this.$3)return;this.$7>0?(b("MStoriesOptimisticInfo").isOptimisticThreadID(this.$8[this.$7])||b("MStoriesLoggingUtils").logStoryNavigation(this.getInsightsLoggingData(),a),this.$30(!1)):b("Stratcom").invoke(b("MStoriesStratcomEvents").PREV_BUCKET,null,{gesture:a})};c.$18=function(a){if(this.$3)return;this.$7<this.$8.length-1?(a&&b("MStoriesLoggingUtils").logStoryNavigation(this.getInsightsLoggingData(),a),this.$30(!0)):b("Stratcom").invoke(b("MStoriesStratcomEvents").NEXT_BUCKET,null,{gesture:a})};c.$31=function(a){__p&&__p();var c=this;b("QuickPerformanceLogger").markerStart(b("StoriesQuickLogModule").STORY_VIEWER_THREAD_TRANSITION_TTI_WWW);var d=this.$7;this.$7=a;b("MStoriesTrackableElements").hideElementsAndInvokeLogging();b("MStoriesDisplayUtils").toggleLoadingScreen(!0);var e=this.$8[this.$7];a="";if(this.$13===b("StoryViewerType").ARCHIVE)a=b("XMStoriesArchiveAsyncViewerController").getURIBuilder().setFBID("card_id",this.$8[this.$7]).setInt("card_index",this.$7).setInt("card_count",this.$8.length).getURI();else if(b("MStoriesOptimisticInfo").isOptimisticThreadID(e)){var f=b("MStoriesOptimisticInfo").getUploadForThreadID(e);f&&(a=b("XMStoriesAsyncOptimisticUploadCardViewerController").getURIBuilder().setInt("creation_time",f.creationTime).setEnum("media_type",f.mediaType).setString("thread_id",f.threadID).setInt("thread_index",this.$7).setInt("thread_count",this.$8.length).getURI(),this.$11[this.$1]=f.threadID,b("MStoriesOptimisticInfo").markUploadSeen(f))}else{f=b("XMStoriesAsyncThreadViewerController").getURIBuilder().setFBID("bucket_id",this.$1).setInt("bucket_index",this.$2).setString("source",b("MStoriesSessionInfo").getSource()).setFBID("thread_id",this.$8[this.$7]).setInt("thread_index",this.$7).setInt("thread_count",this.$8.length).setString("tray_session_id",b("MStoriesSessionInfo").getTraySessionID()).setString("viewer_session_id",b("MStoriesSessionInfo").getViewerSessionID()).setInt("prev_thread_index",d).setFBIDVector("optimistically_deleted_thread_ids",b("MStoriesViewerSheetThreadRelatedInfo").getDeleteThreadIDs());d=this.$8[d];b("MStoriesOptimisticInfo").isOptimisticThreadID(d)||f.setFBID("prev_thread_id",d);a=f.getURI();this.$10[this.$1]=e}this.$3=new(b("XAsyncRequest"))(a).setHandler(function(a){var d;d=(d=a)!=null?(d=d.payload)!=null?d.prevBucket:d:d;a=(a=a)!=null?(a=a.payload)!=null?a.nextBucket:a:a;d?(b("QuickPerformanceLogger").markerEnd(b("StoriesQuickLogModule").STORY_VIEWER_THREAD_TRANSITION_TTI_WWW,"CANCEL"),b("Stratcom").invoke(b("MStoriesStratcomEvents").PREV_BUCKET,null,null)):a?(b("QuickPerformanceLogger").markerEnd(b("StoriesQuickLogModule").STORY_VIEWER_THREAD_TRANSITION_TTI_WWW,"CANCEL"),b("Stratcom").invoke(b("MStoriesStratcomEvents").NEXT_BUCKET,null,null)):(b("Bootloader").loadModules(["MStoriesMutationAPIs"],function(a){a.markThreadSeen(e)},"MStoriesBucketViewer"),c.$27(),c.$28(!1));c.$32()}).setErrorHandler(function(){b("QuickPerformanceLogger").markerEnd(b("StoriesQuickLogModule").STORY_VIEWER_THREAD_TRANSITION_TTI_WWW,"FAIL"),c.$32()});this.$3.send()};c.$30=function(a){a=a?this.$7+1:this.$7-1;this.$31(a)};c.getLastSeenThreadIdForBucketId=function(a){return this.$10[a]};c.getLastSeenOptimisticThreadIdForBucketId=function(a){return this.$11[a]};c.getInsightsLoggingData=function(){return{number_of_media:this.$8.length,media_index:this.$7,media_type:this.$4,owner_id:this.$5,owner_type:this.$6,thread_id:this.$8[this.$7]}};c.$22=function(a,b){for(var c=0;c<this.$8.length;c++){var d=this.$8[c];if(d===b){this.$8[c]=a;break}}};c.$25=function(){b("QuickPerformanceLogger").markerEnd(b("StoriesQuickLogModule").STORY_VIEWER_THREAD_TRANSITION_TTI_WWW,"CANCEL"),this.$12&&(b("MStoriesDisplayUtils").toggleChromeBar(!0,this.$12),this.$12=null),this.$9.forEach(function(a){return a.remove()}),a.$16=null};c.$32=function(){b("Stratcom").invoke("m:stories:card-loaded",null,null),b("MStoriesDisplayUtils").toggleLoadingScreen(!1),this.$3=null};return a}();e.exports=a}),null);
__d("MStoriesProgressbarSegment",["Run"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=function(){__p&&__p();a.getInstance=function(){a.$2||(a.$2=new a());return a.$2};function a(){this.$1=null,this.$3=this.$3.bind(this),b("Run").onLeave(this.$3)}var c=a.prototype;c.update=function(a){if(!this.$1)return!1;this.$1.style.width=a+"%";return!0};c.init=function(a){this.$1=a};c.$3=function(){a.$2=null};return a}();e.exports={init:function(a){g.getInstance().init(a.progressBarSegment)},updateProgressbarSegment:function(a){return g.getInstance().update(a)}}}),null);
__d("MStoriesCardPhoto",["MStoriesProgressbarSegment","MStoriesStratcomEvents","MStoriesUIConstants","MStoriesUtils","Run","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();a.getInstance=function(){this.$5||(this.$5=new a());return this.$5};function a(){__p&&__p();var c=this;this.$1=0;this.$3=null;this.$4=!1;this.$10=function(){c.$1+=b("MStoriesUIConstants").PROGRESS_BAR.STORY_UPDATE_TICK_IN_SEC;var a=c.$1*100/b("MStoriesUIConstants").PROGRESS_BAR.DEFAULT_TIMER_DURATION_IN_SEC;a=Math.min(a,100);var d=b("MStoriesProgressbarSegment").updateProgressbarSegment(a);(!d||a===100)&&(c.$6(),b("Stratcom").invoke(b("MStoriesStratcomEvents").NEXT_CARD))};this.$6=function(){c.$13(),c.$4=!1,c.$1=0};this.$7=function(){c.$6(),a.$5=null};this.$6=this.$6.bind(this);b("Run").onLeave(this.$7)}a.init=function(b){a.getInstance().setup(b)};var c=a.prototype;c.setup=function(a){this.$6(),this.$4=!0,this.$8(),a||this.$9()};c.$8=function(){var a=this;this.$2=[b("Stratcom").listen(b("MStoriesStratcomEvents").MEDIA_PAUSE,null,function(){a.$11()}),b("Stratcom").listen(b("MStoriesStratcomEvents").MEDIA_PLAY,null,function(){a.$12()})];this.$2=this.$2.concat(b("MStoriesUtils").listenForThreadTransition(this.$6))};c.$11=function(){if(!this.$4||!this.$3)return;this.$13()};c.$12=function(){if(!this.$4||this.$3)return;this.$9()};c.$9=function(){if(this.$3)return;this.$3=setInterval(this.$10,b("MStoriesUIConstants").PROGRESS_BAR.STORY_UPDATE_TICK_IN_SEC*b("MStoriesUIConstants").SEC_TO_MS)};c.$13=function(){this.$3&&(clearInterval(this.$3),this.$3=null)};return a}();a.$5=null;e.exports=a}),null);
__d("MStoriesCardReactionsSent",["DOM","MFBStoriesSigil","Run","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();a.init=function(a){var b=this.getInstance();b.$8(a)};a.getInstance=function(){this.$7||(this.$7=new a());return this.$7};function a(){var c=this;this.$1=[];this.$2={};this.$6=b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_REPLY_REACTION,function(a){return c.$9(a)});b("Run").onLeave(function(){c.$6.remove(),a.$7=null})}var c=a.prototype;c.$8=function(a){__p&&__p();var c=a.reactions,d=a.reaction_elements,e=a.name_element;a=a.footer_root_element;this.$1=c;this.$2=d;this.$3=e;c=b("DOM").scry(a,"div");d=c[0];e=c[1];this.$4=d;this.$5=e};c.$9=function(a){a=(a=a.getTarget())!=null?a.firstChild:a;if(!(a instanceof HTMLElement))return;a=a.dataset.reaction;if(a==null)return;this.$1.push(Number(a));this.$10()};c.$10=function(){var a=this;b("DOM").empty(this.$4);this.$1.map(function(c){b("DOM").appendContent(a.$4,a.$2[c])});this.$3!=null&&this.$5!=null&&!this.$5.hasChildNodes()&&b("DOM").appendContent(this.$5,this.$3)};return a}();e.exports=a}),null);
__d("FBKeyframesProject",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({ACTIONABLE_INSIGHTS:"actionable_insights",AD_LIBRARY:"ad_library",ADS_ANIMATOR:"ads_animator",ADS_CLIPBOARD:"ads_clipboard",ADS_LWI:"ads_lwi",ADS_MANAGER_MODERNIZATION:"ads_manager_modernization",ADS_SIGNALS:"ads_signals",ADS_SPLIT_TEST:"ads_split_test",ADS_TARGETING:"ads_targeting",AWESOME_TEXT_POSTS:"awesome_text_posts",AWESOME_TEXT_STORIES:"awesome_text_stories",BALLOT:"ballot",CIVIC_PROPOSAL:"civic_proposal",CMS:"cms",CULTURAL_MOMENTS_QP:"cultural_moments_qp",CULTURAL_MOMENTS_QP_TOOL:"cultural_moments_qp_tool",DIGITAL_LITERACY:"digital_literacy",ELECTION_PHOTO_FORWARD:"election_photo_forward",FACEBOOK_STORIES:"facebook_stories",FEEDBACK_REACTIONS:"feedback_reactions",FUN_FACTS:"fun_facts",FUNDRAISER:"fundraiser",GOODWILL_AR_BIRTHDAY:"goodwill_ar_birthday",GOODWILL_MC:"goodwill_mc",ILLUSTRATION_KIT_TEMPLATE:"illustration_kit_template",KEYFRAMES_UICE:"keyframes_uice",KEYFRAMES_UNIT_TEST:"keyframes_unit_test",LIFE_EVENTS:"life_events",MENTORSHIP:"mentorship",MESSAGING_REACTIONS:"messaging_reactions",MLE_REACTIONS:"mle_reactions",MOBIUS_LOCHA_UI:"mobius_locha_ui",NT_EXAMPLES:"nt_examples",ONCALL_DASHBOARD:"oncall_dashboard",PAGE_SURFACE:"page_surface",PIXELCLOUD:"pixelcloud",PROFILE:"profile",PRIVACY_BASICS:"privacy_basics",RECRUITING_DELIGHT:"recruiting_delight",SHOWREEL:"showreel",SOCIAL_PLAYER:"social_player",TEXT_DELIGHTS:"text_delights",TIME_IN_APP:"time_in_app",UI_INFRASTRUCTURE:"ui_infrastructure",VIDEO_HOME_SOCIAL_GLYPH:"video_home_social_glyph",VOTER_REGISTRATION_DRIVE:"voter_registration_drive",WOODHENGE_OTP:"woodhenge_otp",YOUTH_PORTAL:"youth_portal",VIDPRESSO:"vidpresso",WAGERS:"wagers"})}),null);
__d("MStoriesToast",["cx","fbt","CSS","DOM","FBKeyframesProject","FBLogger","Keyframes","MStoriesStratcomEvents","Run","Stratcom","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=1e3,j=2e3,k=500,l=125,m=280;a=function(){__p&&__p();function a(){var c=this;this.$2=[];this.$5=function(){c.$1&&(b("DOM").remove(c.$1),c.$1=null),c.$2=[],a.$3=null};b("Run").onLeave(this.$5)}a.getInstance=function(){this.$3||(this.$3=new a());return this.$3};var c=a.prototype;c.showToast=function(a,c,d){__p&&__p();var e=this;this.$1&&(this.$2.forEach(function(a){return window.clearTimeout(a)}),b("DOM").remove(this.$1),this.$1=null);d&&b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null);this.$1=b("DOM").create("div",null,a);a=c===null||c===void 0?i:c;b("Stratcom").invoke(b("MStoriesStratcomEvents").TOAST_SHOWING,null);b("DOM").appendContent(document.body,this.$1);this.$2=[window.setTimeout(function(){e.$1&&b("CSS").addClass(e.$1,"_1ufk")},a),window.setTimeout(function(){b("DOM").remove(e.$1),d&&b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null),b("Stratcom").invoke(b("MStoriesStratcomEvents").TOAST_HIDING,null),e.$1=null},a+k)]};a.showDefaultToast=function(c,d){c=b("DOM").create("div",{className:"_3fcy"},c);c=b("DOM").create("div",{className:"_30l6 bottom"},c);a.getInstance().showToast(c,d)};a.showReplySentSuccessToast=function(c,d){d===void 0&&(d=!0);var e=null;c?e=b("DOM").create("div",{className:"_30l3"},c):e=b("DOM").create("div",{className:"_30l4"});c=b("DOM").create("div",{className:"_30l5"},h._("Reply Sent"));e=b("DOM").create("div",{className:"_30l6"},[e,c]);a.getInstance().showToast(e,i,d)};a.showReactionSentSuccessToast=function(a,c){var d=b("DOM").create("div",{className:"_6kiw"});b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null);b("Stratcom").invoke(b("MStoriesStratcomEvents").TOAST_SHOWING,null);b("promiseDone")(b("Keyframes").requestRenderer(a,{projectName:b("FBKeyframesProject").FACEBOOK_STORIES,assetName:c}),function(a){b("DOM").appendContent(document.body,d),b("DOM").appendContent(d,a.getElement()),a.play(),window.setTimeout(function(){b("DOM").remove(d),b("Stratcom").invoke(b("MStoriesStratcomEvents").TOAST_HIDING,null),b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null)},k)},function(a){b("FBLogger")("fb_stories_web").catching(a).warn("Cannot load mtouch reaction animation")})};a.newShowReactionSentSuccessToast=function(a,c,d){var e=this,f=b("DOM").create("div",{className:"_7g_7"});b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null);b("Stratcom").invoke(b("MStoriesStratcomEvents").TOAST_SHOWING,null);b("promiseDone")(b("Keyframes").requestRenderer(a,{projectName:b("FBKeyframesProject").FACEBOOK_STORIES,assetName:c}),function(a){b("DOM").appendContent(d,f),b("DOM").appendContent(f,a.getElement()),a.setWidth(l),a.setHeight(m),a.play(),e.$4+=1,a.onRepeatEnd(function(){a.pause(),b("DOM").remove(f),e.$4-=1,e.$4===0&&(b("Stratcom").invoke(b("MStoriesStratcomEvents").TOAST_HIDING,null),b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null))})},function(a){b("FBLogger")("fb_stories_web").catching(a).warn("Cannot load mtouch reaction animation")})};a.showReplySentFailedToast=function(){var c=b("DOM").create("div",{className:"_30l7"}),d=b("DOM").create("div",{className:"_30l5"},h._("Sent Failed"));c=b("DOM").create("div",{className:"_30l6"},[c,d]);a.getInstance().showToast(c,i)};a.showVideoAutoPlayNux=function(){var c=b("DOM").create("div",{className:"_7tz_"},h._("Videos play automatically on Wi-Fi, without using mobile data"));c=b("DOM").create("div",{className:"_7t-0"},[c]);a.getInstance().showToast(c,j)};return a}();a.$4=0;e.exports=a}),null);
__d("MStoriesCardVideo",["MInlineVideo","MStoriesDOMUtils","MStoriesGating","MStoriesProgressbarSegment","MStoriesSessionInfo","MStoriesStratcomEvents","MStoriesToast","MStoriesUIConstants","MStoriesUtils","MVideoUtils","Run","Stratcom","Style","VideoPlayerReason"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="m-video-play-button";a=function(){__p&&__p();function a(){__p&&__p();var c=this;this.$1=0;this.$2=[];this.$3=!1;this.$4=null;this.$5=!0;this.$6=null;this.$7=null;this.$14=function(){var a=!c.$5&&c.$6?c.$6:b("MStoriesUIConstants").PROGRESS_BAR.DEFAULT_TIMER_DURATION_IN_SEC*b("MStoriesUIConstants").SEC_TO_MS;c.$1+=b("MStoriesUIConstants").PROGRESS_BAR.STORY_UPDATE_TICK_IN_SEC;a=c.$1*100*b("MStoriesUIConstants").SEC_TO_MS/a;a=Math.min(a,100);var d=b("MStoriesProgressbarSegment").updateProgressbarSegment(a);(!d||a===100)&&(c.$10(),b("Stratcom").invoke(b("MStoriesStratcomEvents").NEXT_CARD))};this.$10=function(){c.$16(),c.$15(),c.$3=!1,c.$6=0,c.$5=!0,c.$1=0};this.$11=function(){c.$2.forEach(function(a){return a.remove()}),c.$2=[],c.$10(),a.$8=null};this.$10=this.$10.bind(this);b("Run").onLeave(this.$11)}a.getInstance=function(){this.$8||(this.$8=new a());return this.$8};a.init=function(b){a.getInstance().setup(b.videoDuration,b.shouldPauseMedia,b.videoElem)};var c=a.prototype;c.setup=function(a,c,d){this.$10(),this.$6=a,this.$5=!0,this.$3=!0,this.$7=b("MStoriesDOMUtils").find(d,"div",g),this.$12(),c||this.$13()};c.$12=function(){var c=this;this.$2=[b("Stratcom").listen(b("MStoriesStratcomEvents").VIDEO_PLAYING,null,function(){a.$9!=b("MStoriesSessionInfo").getViewerSessionID()&&b("MInlineVideo").getLastActionReason()===b("VideoPlayerReason").AUTOPLAY&&b("MStoriesGating").shouldShowAPNux()&&(a.$9=b("MStoriesSessionInfo").getViewerSessionID(),b("MStoriesToast").showVideoAutoPlayNux()),b("Stratcom").removeCurrentListener(),c.$15(),c.$1=0,c.$5=!1,c.$13()}),b("Stratcom").listen(b("MStoriesStratcomEvents").VIDEO_PLAY,null,function(){c.$5&&(c.$15(),c.$1=0)}),b("Stratcom").listen(b("MStoriesStratcomEvents").MEDIA_PAUSE,null,function(){c.$16()}),b("Stratcom").listen(b("MStoriesStratcomEvents").MEDIA_PLAY,null,function(){c.$17()}),b("Stratcom").listen(b("MStoriesStratcomEvents").TOAST_HIDING,null,function(){c.$5&&c.$7&&b("Style").set(c.$7,"display","block")}),b("Stratcom").listen(b("MStoriesStratcomEvents").TOAST_SHOWING,null,function(){c.$5&&c.$7&&b("Style").set(c.$7,"display","none")})];this.$2=this.$2.concat(b("MStoriesUtils").listenForThreadTransition(this.$10))};c.$16=function(){if(!this.$3||!this.$4)return;this.$15();b("MInlineVideo").getPlayerState()===b("MVideoUtils").PLAYER_STATE.playing&&b("MInlineVideo").pause(b("VideoPlayerReason").USER)};c.$17=function(){if(!this.$3||this.$4)return;this.$13();this.$5||b("MInlineVideo").play(b("VideoPlayerReason").USER)};c.$13=function(){if(this.$4)return;this.$4=window.setInterval(this.$14,b("MStoriesUIConstants").PROGRESS_BAR.STORY_UPDATE_TICK_IN_SEC*b("MStoriesUIConstants").SEC_TO_MS)};c.$15=function(){this.$4&&(window.clearInterval(this.$4),this.$4=null)};return a}();a.$8=null;a.$9=null;e.exports=a}),null);
__d("MStoriesOptionConfirmationButtons",["cx","fbt","Bootloader","CloseStoryGesture","CSS","FBStoriesLoggingConstants","MFBStoriesSigil","MStoriesBucketViewer","MStoriesDisplayUtils","MStoriesLoggingUtils","MStoriesStratcomEvents","MStoriesToast","MStoriesUIConstants","MStoriesUtils","MStoriesViewerSheetThreadRelatedInfo","Run","Stratcom","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=2e3;a=function(){__p&&__p();function a(){__p&&__p();var c=this;this.$6=!1;this.$7=null;this.$12=function(){c.$1.forEach(function(a){return a.remove()}),a.$8=null};this.$1=[b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_MUTE_BUCKET_CONFIRM,function(a){c.$9(),b("Stratcom").invoke(b("MStoriesStratcomEvents").MUTE_BUCKET,null),b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null),c.$4&&b("Bootloader").loadModules(["MStoriesMutationAPIs"],function(a){a.muteStoryOwner(c.$4)},"MStoriesOptionConfirmationButtons")}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_MUTE_BUCKET_CANCEL,function(a){c.$9(),b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null)}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_DELETE_THREAD_CONFIRM,function(a){__p&&__p();c.$10(b("FBStoriesLoggingConstants").ACTION_DELETE_MEDIA);c.$11();b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null);b("MStoriesToast").showDefaultToast(h._("Deleted"),i);b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE,null);var d=c.$5;b("MStoriesViewerSheetThreadRelatedInfo").addDeletedThreadIDs(d);var e=function(){b("MStoriesViewerSheetThreadRelatedInfo").removeDeletedThreadIDs(d)};b("Bootloader").loadModules(["MStoriesMutationAPIs"],function(a){b("MStoriesBucketViewer").isArchiveStoryViewer()?b("promiseDone")(a.deleteArchivedStoryCard(c.$7),e,e):b("promiseDone")(a.deleteThread(d),e,e),b("Stratcom").invoke(b("MStoriesStratcomEvents").DELETE_THREAD,null,null)},"MStoriesOptionConfirmationButtons")}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_DELETE_THREAD_CANCEL,function(a){c.$11(),b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null)}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_CLOSE_STORY_BUTTON,function(a){if(c.$6)return;c.$6=!0;a=a.getData()||{};b("MStoriesLoggingUtils").logCloseStory({thread_id:c.$5,media_type:c.$3,owner_id:c.$4,owner_type:null},(a=b("CloseStoryGesture").fromString(a.gesture))!=null?a:b("CloseStoryGesture").CLOSE_BUTTON_EXIT,{media_id:c.$2});b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE,null,null);b("MStoriesDisplayUtils").toggleLoadingScreen(!0,!0);window.setTimeout(function(){b("MStoriesUtils").goBackToHomepage()},b("MStoriesUIConstants").REDIRECT_DELAY_IN_MS)}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_SEEN_SUMMARY_ANCHOR,function(a){c.$10(b("FBStoriesLoggingConstants").ACTION_OPEN_SEEN_SUMMARY)}),b("Stratcom").listen(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null,function(){c.$11(),c.$9()})];b("Run").onLeave(this.$12)}a.getInstance=function(){this.$8||(this.$8=new a());return this.$8};var c=a.prototype;c.$9=function(){var a=document.getElementById("m-stories-mute-bucket-confirm-dialog");a&&b("CSS").addClass(a,"_69p_")};c.$10=function(a,c){var d=this;c===void 0&&(c=null);b("Bootloader").loadModules(["MStoriesTypedLogger"],function(b){new b().setName(a).setStoryOwner(d.$4).setMediaType(d.$3).setClientMediaID(d.$2).setCardID(d.$5).setGesture(c).log()},"MStoriesOptionConfirmationButtons")};c.$11=function(){var a=document.getElementById("m-stories-delete-thread-confirm-dialog");a&&b("CSS").addClass(a,"_69p_")};a.initMuteConfirmationButtons=function(b){var c=a.getInstance();c.$4=b.storyOwnerID};a.init=function(b){var c=a.getInstance();c.$5=b.threadID;c.$4=b.storyOwnerID;c.$2=b.mediaID;c.$3=b.mediaType;c.$7=b.storyGraphQLID;c.$6=!1};return a}();e.exports=a}),null);
__d("XMStoriesSettingsController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/settings/",{})}),null);
__d("MStoriesOptionMenu",["cx","CSS","MFBStoriesSigil","MPageController","MStoriesDisplayUtils","MStoriesHideHeaderListener","MStoriesStratcomEvents","Run","Stratcom","XMStoriesSettingsController"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(){__p&&__p();function a(){__p&&__p();var c=this;this.$8=function(){c.$1.forEach(function(a){return a.remove()}),a.$5=null};this.$1=[b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_OPTIONS_BUTTON,function(a){a=c.$6();if(!a)return;var d="_68j_";b("CSS").hasClass(a,d)&&(b("CSS").removeClass(a,d),b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null,null))}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_OPTION_MENU_MUTE,function(a){c.$7(),c.$2&&b("CSS").removeClass(c.$2,"_69p_")}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_OPTION_MENU_DELETE_THREAD,function(a){c.$7(),c.$3&&b("CSS").removeClass(c.$3,"_69p_")}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_OPTION_MENU_REPORT,function(a){c.$7(),b("MStoriesHideHeaderListener").setup(),b("MPageController").load(c.$4)}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_OPTION_MENU_STORY_SETTINGS,function(a){a=b("XMStoriesSettingsController").getURIBuilder().getURI();c.$7();b("MStoriesDisplayUtils").toggleChromeBar(!1);b("MPageController").load(a,{hideLoadingIndicator:!0})}),b("Stratcom").listen(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null,function(){c.$7()})];b("Run").onLeave(this.$8)}var c=a.prototype;c.$6=function(){return document.getElementById("mtouch-story-option-menu")};c.$7=function(){var a=this.$6();a&&b("CSS").addClass(a,"_68j_")};a.getInstance=function(){this.$5||(this.$5=new a());return this.$5};a.initConfirmationDialogs=function(b){var c=b.optionDeleteConfirmationDialog;b=b.optionMuteConfirmationDialog;var d=a.getInstance();d.$3=c;d.$2=b};a.initReportURI=function(b){b=b.reportURI;var c=a.getInstance();c.$4=b};return a}();e.exports=a}),null);
__d("FeedbackReactionType",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({NONE:0,LIKE:1,LOVE:2,WOW:3,HAHA:4,YAY:5,OUCH:6,SORRY:7,ANGER:8,JACKO:9,CONFUSED:10,DOROTHY:11,TOTO:12,SELFIE:13,FLAME:14,PLANE:15})}),null);
__d("MFBStoriesConstants",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({INPUT_PLACE_HOLDER:"Reply...",RAINBOW_NO_EFFECT_ICON:"/images/stories/rainbow_no_effect_icon.png",FEED_UNIT_TRAY_PREFIX:"TRAY_"})}),null);
__d("MStoriesLoggingConstants",[],(function(a,b,c,d,e,f){"use strict";a={REPLY_TYPES:{LIGHT_WEIGHT:"light_weight",TEXT:"text"}};e.exports=a}),null);
__d("MStoriesPostReplyInstance",["cx","fbt","Bootloader","CSS","FeedbackReactionType","MFBStoriesConstants","MFBStoriesGatingConfig","MFBStoriesReactionAnimationConfig","MFBStoriesSigil","MStoriesLoggingConstants","MStoriesStratcomEvents","MStoriesToast","MStoriesUtils","MViewport","QE2Logger","Run","Stratcom","WebFunnelLogger","promiseDone","throttle","uniqueID"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=function(a){switch(a){case b("FeedbackReactionType").LIKE:return"\ud83d\udc4d";case b("FeedbackReactionType").LOVE:return"\u2764\ufe0f";case b("FeedbackReactionType").HAHA:return"\ud83d\ude06";case b("FeedbackReactionType").WOW:return"\ud83d\ude2e";case b("FeedbackReactionType").SORRY:return"\ud83d\ude22";case b("FeedbackReactionType").ANGER:return"\ud83d\ude21";default:return null}},j=(a={},a[b("FeedbackReactionType").LIKE]="LIKE",a[b("FeedbackReactionType").LOVE]="LOVE",a[b("FeedbackReactionType").HAHA]="HAHA",a[b("FeedbackReactionType").WOW]="WOW",a[b("FeedbackReactionType").SORRY]="SORRY",a[b("FeedbackReactionType").ANGER]="ANGER",a),k=100;c=function(){__p&&__p();a.init=function(b){var c=a.getInstance();c.$1=babelHelpers["extends"]({},b);this.$4=c};a.getInstance=function(){this.$4||(this.$4=new a());return this.$4};function a(){__p&&__p();var c=this;this.$2=null;this.$5=function(){c.$3.forEach(function(a){return a.remove()}),c.$3=[],a.$4=null};this.$6=function(){c.$2&&c.$2.dispose(),c.$2=null};this.$3=[];this.listenForSendButton();this.listenForEmojiOrLightweightReaction();this.listenForReplyInput();this.listenForSwipeReply();this.listenForProfileDiv();this.listenForBucketTransition();this.listenForScrollableArea();b("Run").onLeave(this.$5)}var c=a.prototype;c.listenForBucketTransition=function(){this.$3.push(b("Stratcom").listen(b("MStoriesStratcomEvents").NEXT_BUCKET,null,this.$5),b("Stratcom").listen(b("MStoriesStratcomEvents").PREV_BUCKET,null,this.$5))};c.listenForScrollableArea=function(){this.$3.push(b("Stratcom").listen("MScrollArea:create",null,function(b){b=b.getData();b.element.id==="mtouch-stories-reply-scroll-area"&&(a.getInstance().$2=b.scrollarea)})),this.$3.concat(b("MStoriesUtils").listenForThreadTransition(this.$6))};c.listenForSendButton=function(){__p&&__p();var a=this,c="",d=b("Stratcom").listen("input",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(d){c=d.getTarget().value,c=c&&c.trim(),c&&c.length>0?(a.$1.sendButton.disabled=!1,b("CSS").addClass(a.$1.sendButton,"highlight")):(a.$1.sendButton.disabled=!0,b("CSS").removeClass(a.$1.sendButton,"highlight"))}),e=b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_REPLY_SEND_BUTTON,function(){__p&&__p();if(!c||c.length===0)return;new(b("WebFunnelLogger"))("FBStoriesMTouchTextReplyFunnelDefinition").setSessionKey(a.$1.funnelSessionID).setAction("clicked send button").log();b("Bootloader").loadModules(["MStoriesMutationAPIs"],function(d){b("promiseDone")(d.sendMessage(a.$1.threadId,c,a.$1.postType,a.$1.ownerID,b("MStoriesLoggingConstants").REPLY_TYPES.TEXT),function(){new(b("WebFunnelLogger"))("FBStoriesMTouchTextReplyFunnelDefinition").setSessionKey(a.$1.funnelSessionID).setAction("Message sent success").markEnd().log()},function(c){new(b("WebFunnelLogger"))("FBStoriesMTouchTextReplyFunnelDefinition").setSessionKey(a.$1.funnelSessionID).addActionPayload("error",c).setAction("Message sent failure").markEnd().log()})},"MStoriesPostReplyInstance");a.$1.sendButton.disabled=!0;a.$1.input.blur();b("CSS").removeClass(a.$1.sendButton,"highlight");b("MStoriesToast").showReplySentSuccessToast(null,!1)}),f=b("Stratcom").listen("blur",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){return b("CSS").addClass(a.$1.sendButton,"hidden_elem")}),g=b("Stratcom").listen("focus",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){return b("CSS").removeClass(a.$1.sendButton,"hidden_elem")});this.$3.push(e,d,f,g)};c.listenForEmojiOrLightweightReaction=function(){__p&&__p();var a=this;this.$3.push(b("Stratcom").listen("blur",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){return b("CSS").show(a.$1.emoji)}));this.$3.push(b("Stratcom").listen("focus",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){return b("CSS").hide(a.$1.emoji)}));this.$3.push(b("Stratcom").listen("MScrollArea:scrollstart",null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER)}));this.$3.push(b("Stratcom").listen("MScrollArea:scrollend",null,function(a){a=a.getData();a.scrollarea.getScrollLeft()<=0&&b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PLAY)}));var c=function(c){__p&&__p();var d;b("QE2Logger").logExposureForUser("lwr_trails_fbstories_mtouch_universe");d=(d=c.getTarget())!=null?(d=d.firstChild)!=null?(d=d.dataset)!=null?d.reaction:d:d:d;if(!d)return;var e=i(Number(d));if(!e)return;b("Bootloader").loadModules(["MStoriesMutationAPIs"],function(c){b("promiseDone")(c.sendLightweightReaction(a.$1.threadId,a.$1.postType,a.$1.ownerID,e))},"MStoriesPostReplyInstance");if(b("MFBStoriesGatingConfig").showLWRTrails){var f="\n          "+b("MFBStoriesReactionAnimationConfig").uris[d]+"&"+b("uniqueID")(),g=j[d];b("MStoriesToast").newShowReactionSentSuccessToast(f,g,c.getTarget())}else{f=b("MFBStoriesReactionAnimationConfig").uris[d];g="reaction_type_"+d;b("MStoriesToast").showReactionSentSuccessToast(f,g)}};b("MFBStoriesGatingConfig").showLWRTrails?this.$3.push(b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_REPLY_REACTION,b("throttle")(c,k))):this.$3.push(b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_REPLY_REACTION,c));this.$3.push(b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_REPLY_EMOJI,function(c){var d=(c=c.getTarget())!=null?(c=c.firstChild)!=null?c.data:c:c;if(!d||d.length===0)return;b("Bootloader").loadModules(["MStoriesMutationAPIs"],function(c){b("promiseDone")(c.sendMessage(a.$1.threadId,d,a.$1.postType,a.$1.ownerID,b("MStoriesLoggingConstants").REPLY_TYPES.LIGHT_WEIGHT))},"MStoriesPostReplyInstance");b("MStoriesToast").showReplySentSuccessToast(d)}))};c.listenForReplyInput=function(){__p&&__p();var c=this,d=h._("{Placeholder string}",[h._param("Placeholder string",b("MFBStoriesConstants").INPUT_PLACE_HOLDER)]).toString(),e=function(a){return h._("Reply to {Story's owner name}",[h._param("Story's owner name",a)]).toString()},f=b("Stratcom").listen("focus",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){document.removeEventListener("touchmove",b("MStoriesUtils").touchMoveListener);var d=a.getInstance().$2;d&&d.reset();b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null);d=c.$1.input.value;c.$1.ownerName&&(!d||d.length===0)&&(c.$1.input.placeholder=e(c.$1.ownerName));new(b("WebFunnelLogger"))("FBStoriesMTouchTextReplyFunnelDefinition").setSessionKey(c.$1.funnelSessionID).markStart().setAction("text input focused").log()}),g=b("Stratcom").listen("blur",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){document.addEventListener("touchmove",b("MStoriesUtils").touchMoveListener,{passive:!1});b("MViewport").scrollToTop();b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null);var a=c.$1.input.value;(!a===null||a.length===0)&&(c.$1.input.placeholder=d)}),i=b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_REPLY_SEND_BUTTON,function(){c.$1.input.value="",c.$1.input.placeholder=d}),j=b("Stratcom").listen("keyup",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(a){var b=a.getRawEvent().key;b==="Enter"&&(a.prevent(),c.$1.sendButton.click())});this.$3.push(i,f,g,j)};c.listenForSwipeReply=function(){var a=this,c=b("Stratcom").listen(b("MStoriesStratcomEvents").SWIPE_REPLY,null,function(){if(!b("MFBStoriesGatingConfig").enableSwipeReply)return;new(b("WebFunnelLogger"))("FBStoriesMTouchTextReplyFunnelDefinition").setSessionKey(a.$1.funnelSessionID).markStart().setAction("swipe up").log();a.$1.input.focus()});this.$3.push(c)};c.listenForProfileDiv=function(){var a=this,c=b("Stratcom").listen("blur",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){return b("CSS").addClass(a.$1.profilePicDiv,"hidden_elem")}),d=b("Stratcom").listen("focus",b("MFBStoriesSigil").VIEWER_REPLY_INPUT,function(){return b("CSS").removeClass(a.$1.profilePicDiv,"hidden_elem")});this.$3.push(c,d)};return a}();e.exports=c}),null);
__d("MStoriesTransitionSwipeDetector",["CloseStoryGesture","MFBStoriesSigil","MStoriesStratcomEvents","MStoriesUIConstants","MViewport","Run","StoryNavigationGesture","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){a=a.getRawEvent();if(!a)return null;a=a.targetTouches[0];return{x:a.pageX+b("MViewport").getScrollLeft(),y:a.pageY+b("MViewport").getScrollTop()}}a=function(){__p&&__p();var a=this;this.$7=function(){a.$3=null,a.$4=0,a.$5=0,a.$2&&(a.$2.remove(),a.$2=null)};this.$6=function(c){a.$3=null;if(c.getPrevented())return;a.$7();a.$3=g(c);a.$2=b("Stratcom").listen("touchmove",null,a.$10)};this.$8=function(c){__p&&__p();a.$3=null;if(c.getPrevented())return;if(Math.abs(a.$5)>b("MStoriesUIConstants").SWIPE_DOWN_DISTANCE&&a.$5>0){b("Stratcom").invoke(b("MStoriesStratcomEvents").SWIPE_DOWN);return}if(Math.abs(a.$5)>b("MStoriesUIConstants").SWIPE_DISTANCE&&a.$5<0){b("Stratcom").invoke(b("MStoriesStratcomEvents").SWIPE_UP);a.$7();return}Math.abs(a.$4)>b("MStoriesUIConstants").SWIPE_DISTANCE&&(a.$4>0?b("Stratcom").invoke(b("MStoriesStratcomEvents").SWIPE_LEFT):b("Stratcom").invoke(b("MStoriesStratcomEvents").SWIPE_RIGHT));a.$7()};this.$10=function(b){__p&&__p();if(b.getPrevented()){a.$7();return}b=g(b);if(!b)return;var c=a.$3;if(!c)return;a.$4=b.x-c.x;a.$5=b.y-c.y};this.$9=function(){a.$1.forEach(function(a){return a.remove()}),a.$7()};this.$1=[b("Stratcom").listen("touchstart",b("MFBStoriesSigil").VIEWER_PREV_BUCKET_BUTTON,this.$6),b("Stratcom").listen("touchstart",b("MFBStoriesSigil").VIEWER_NEXT_BUCKET_BUTTON,this.$6),b("Stratcom").listen("touchstart",b("MFBStoriesSigil").VIEWER_THREAD_MEDIA,this.$6),b("Stratcom").listen("touchcancel",null,this.$7),b("Stratcom").listen("touchend",null,this.$8)];b("Run").onLeave(this.$9)};e.exports=a}),null);
__d("MStoriesThread",["cx","CloseStoryGesture","DOM","MFBStoriesSigil","MStoriesBottomSheetController","MStoriesDOMUtils","MStoriesGating","MStoriesMutationAPIs","MStoriesOptimisticInfo","MStoriesStratcomEvents","MStoriesTransitionSwipeDetector","MStoriesUtils","Run","StoryNavigationGesture","Stratcom"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h="m:stories:thread:modal";a=function(){__p&&__p();function a(){__p&&__p();var c=this;this.$6=function(){c.$1.forEach(function(a){return a.remove()}),document.removeEventListener("touchmove",b("MStoriesUtils").touchMoveListener),a.$5=null};this.$4=new(b("MStoriesTransitionSwipeDetector"))();this.$1=[b("Stratcom").listen(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE),c.showCover()}),b("Stratcom").listen(b("MStoriesStratcomEvents").MEDIA_PLAY,null,function(){c.hideCover()}),b("Stratcom").listen(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").VIEWER_SHEET_HIDE,null),b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PLAY,null)}),b("Stratcom").listen("click",h,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").THREAD_MODAL_HIDE,null)}),b("Stratcom").listen("touchstart",b("MFBStoriesSigil").VIEWER_THREAD_MEDIA,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE,null)}),b("Stratcom").listen("touchend",b("MFBStoriesSigil").VIEWER_THREAD_MEDIA,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PLAY,null)}),b("Stratcom").listen("touchstart",b("MFBStoriesSigil").VIEWER_PREV_BUCKET_BUTTON,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE,null)}),b("Stratcom").listen("touchend",b("MFBStoriesSigil").VIEWER_PREV_BUCKET_BUTTON,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PLAY,null)}),b("Stratcom").listen("touchstart",b("MFBStoriesSigil").VIEWER_NEXT_BUCKET_BUTTON,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE,null)}),b("Stratcom").listen("touchend",b("MFBStoriesSigil").VIEWER_NEXT_BUCKET_BUTTON,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PLAY,null)}),b("Stratcom").listen("click",b("MFBStoriesSigil").VIEWER_ADD_STORY_BUTTON,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE)}),b("Stratcom").listen(b("MStoriesStratcomEvents").SWIPE_LEFT,null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").PREV_BUCKET,null,{gesture:b("StoryNavigationGesture").SWIPE_LEFT})}),b("Stratcom").listen(b("MStoriesStratcomEvents").SWIPE_RIGHT,null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").NEXT_BUCKET,null,{gesture:b("StoryNavigationGesture").SWIPE_RIGHT})}),b("Stratcom").listen(b("MStoriesStratcomEvents").SWIPE_DOWN,null,function(){b("Stratcom").invoke("click",b("MFBStoriesSigil").VIEWER_CLOSE_STORY_BUTTON,{gesture:b("CloseStoryGesture").SWIPE_DOWN_EXIT})}),b("Stratcom").listen(b("MStoriesStratcomEvents").SWIPE_UP,null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").SWIPE_REPLY),b("MStoriesGating").shouldShowNTViewerSheet()&&b("Stratcom").invoke(b("MStoriesStratcomEvents").VIEWER_SHEET_OPEN)}),b("Stratcom").listen(b("MStoriesStratcomEvents").OVERLAY_INTERACTION_PAUSE,null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE)}),b("Stratcom").listen(b("MStoriesStratcomEvents").OVERLAY_INTERACTION_PLAY,null,function(){b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PLAY)})];document.addEventListener("touchmove",b("MStoriesUtils").touchMoveListener,{passive:!1});b("Run").onLeave(this.$6)}a.getInstance=function(){this.$5||(this.$5=new a());return this.$5};var c=a.prototype;c.showCover=function(){if(this.$2!==null)return;this.$2=b("DOM").create("div",{className:"modal",sigil:h});b("DOM").appendContent(this.$3,this.$2)};c.hideCover=function(){this.$2!==null&&(b("DOM").remove(this.$2),this.$2=null)};a.initOptimistic=function(c){var d=c.root,e=c.threadID,f=a.getInstance();f.$2=null;f.$3=d;f=b("MStoriesDOMUtils").find(c.root,"div",b("MFBStoriesSigil").VIEWER_THREAD_MEDIA);if(f){d=b("MStoriesOptimisticInfo").getUploadForThreadID(e);d&&(b("DOM").setContent(f,b("MStoriesOptimisticInfo").getCanvasForViewer(d)),b("MStoriesOptimisticInfo").markUploadSeen(d))}};a.init=function(c){var d=a.getInstance();d.$2=null;d.$3=c.root;c.storyGraphQLID!=null?b("MStoriesMutationAPIs").markThreadSeen(null,c.storyGraphQLID):b("MStoriesMutationAPIs").markThreadSeen(c.threadID);c.bottomSheetContainer!=null&&b("MStoriesBottomSheetController").setContainer(c.bottomSheetContainer);b("MStoriesGating").shouldShowNTViewerSheet()&&c.shouldExpandViewerSheet===!0&&(b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE_WITH_COVER,null),b("Stratcom").invoke(b("MStoriesStratcomEvents").CLICK_STORY_IN_VIEWER_SHEET));b("Stratcom").invoke("m:stories:card-loaded",null,null)};return a}();e.exports=a}),null);