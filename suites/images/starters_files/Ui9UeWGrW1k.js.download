if (self.CavalryLogger) { CavalryLogger.start_js(["Kweql"]); }

__d("ChatProxyConnectionState",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.auxiliaryIrisQueues={},this.aiq=null}var b=a.prototype;b.subscribeIrisQueue=function(a,b){this.auxiliaryIrisQueues[a]=b,this.updateCaches()};b.unsubscribeIrisQueue=function(a){delete this.auxiliaryIrisQueues[a],this.updateCaches()};b.updateCaches=function(){var a=[];for(var b in this.auxiliaryIrisQueues)Object.prototype.hasOwnProperty.call(this.auxiliaryIrisQueues,b)&&(a.push(b),a.push(this.auxiliaryIrisQueues[b]));a.length===0?this.aiq=null:this.aiq=a.join(",")};return a}();e.exports=a}),null);
__d("ChannelDefaults",[],(function(a,b,c,d,e,f){e.exports={LONGPOLL_TIMEOUT:6e4,STALL_THRESHOLD:18e4,MIN_RETRY_INTERVAL:5e3,MAX_RETRY_INTERVAL:3e4}}),null);
__d("ChannelEventEmitter",["EventEmitter"],(function(a,b,c,d,e,f){"use strict";a=new(b("EventEmitter"))();e.exports=a}),null);
__d("ChannelEventType",[],(function(a,b,c,d,e,f){e.exports={FRIEND_REQUESTS_ADD:"jewel_requests_add",FRIEND_REQUESTS_COUNT:"mobile_requests_count",FRIEND_REQUESTS_REMOVE:"jewel_requests_remove_old",FRIEND_REQUESTS_SEEN:"friend_requests_seen",INBOX:"inbox",MESSAGE:"messaging",PAGES_MESSAGE:"pages_messaging",TYPING:"typ",PAGE_THREAD_FLAG_CHANGED:"change_page_thread_flag",NOTIFICATIONS_NEW:"m_notification",NOTIFICATIONS_READ:"notifications_read",NOTIFICATIONS_SEEN:"notifications_seen",GRAPHQL_SUBSCRIPTIONS:"graphql",RTI_SESSION:"rti_session",GET_RTI_SESSION_REQUEST:"rti_session_request",SKYWALKER_MESSAGE:"skywalker_message",DELTA:"delta"}}),null);
__d("ChannelStateMap",[],(function(a,b,c,d,e,f){e.exports={pull:{ok:"pull!",error:"pull",error_missing:"pull",error_msg_type:"pull",clock_anomaly:"pull!",visible:"pull!",hidden:"idle!",refresh_0:"reconnect",refresh_110:"reconnect!",refresh_111:"reconnect",refresh_112:"pull",refresh_113:"pull",refresh_117:"reconnect"},reconnect:{ok:"pull!",error:"reconnect",clock_anomaly:"reconnect!",visible:"pull!",hidden:"idle!"},idle:{ok:"idle!",clock_anomaly:"idle!",visible:"pull!",hidden:"idle!"},shutdown:{clock_anomaly:"shutdown!",visible:"shutdown!",hidden:"shutdown!"}}}),null);
__d("RTISession",["invariant","ErrorUtils","PHPQuerySerializer","URI","XHRRequest","getCrossOriginTransport"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=".facebook.com";a=function(){__p&&__p();function a(a,b,c,d,e,f,h,i,j){a||g(0,2469),d||g(0,2470),e||g(0,2471),this.domain=a,this.port=b,this.edgePoolName=c,this.stickyToken=d,this.loggedInId=e,this.accountId=f,this.clientProfile=h||"desktop",this.clientId=i,this.capabilities=j}var c=a.prototype;c.issueRequest=function(a,c,d,e,f){__p&&__p();var i=this;a||g(0,2472);c||g(0,2473);e||g(0,2474);var j=this.domain.length-h.length;j=j>0&&this.domain.indexOf(h,j)!==-1;j=j?this.domain:this.domain+h;var k=(1048576*Math.random()|0).toString(36);k={cb:k,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var l in k)c[l]&&g(0,1632);Object.assign(k,c);c=new(b("URI"))(a).setDomain(j).setPort(this.port).setSecure(new(b("URI"))(window.location.href).isSecure()).setQueryData(k);a=d?"POST":"GET";var m={};new(b("XHRRequest"))(c).setTransportBuilder(b("getCrossOriginTransport").withCredentials).setTimeout(f?f*1e3:3e4).setMethod(a).setDataSerializer(function(a){return b("PHPQuerySerializer").serialize(JSON.stringify(a))}).setData(d).setRequestHeader("Content-Type","application/x-www-form-urlencoded").setResponseHandler(function(a){a=a.substring("for (;;);".length);m.data=JSON.parse(a);m.error=null;b("ErrorUtils").applyWithGuard(e,i,[m])}).setErrorHandler(function(a){m.data=null,m.error=a.errorMsg||"error",b("ErrorUtils").applyWithGuard(e,i,[m])}).send()};return a}();e.exports=a}),null);
__d("StateMachine",["EventEmitter","ex","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();var g=0,h=function(){"use strict";__p&&__p();function a(a,b){this.idx=g++,this.machine=a,this.asap=b&&b.substr(-1)=="!",this.name=this.asap?b.substr(0,b.length-1):b,this.progress=j.NEW,this.status=null}var b=a.prototype;b.enter=function(){this.machine.enter_private(this)};b.exit=function(a){this.machine.exit_private(this,a)};b.toString=function(){return this.name+"("+this.progress+","+this.status+")"};return a}(),i="_ABORT_",j=function(c){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,c);function a(a,b){var d;d=c.call(this)||this;d.$StateMachine1=a;d.$StateMachine2=b;d.$StateMachine3=0;d.$StateMachine4=[];d.$StateMachine5=Date.now();return d}var d=a.prototype;d.$StateMachine6=function(a){this.$StateMachine4.push(Date.now()-this.$StateMachine5+": "+a),this.$StateMachine4.length>40&&(this.$StateMachine4=this.$StateMachine4.splice(-20))};d.getState=function(){return this.$StateMachine7};d.setDelay=function(a){this.$StateMachine3=a||0;return this};d.getDelay=function(){return this.$StateMachine3};d.enter=function(a){this.enter_private(new h(this,a))};d.enter_private=function(c){this.$StateMachine6("enter "+c+", "+this.$StateMachine7),this.$StateMachine7&&this.$StateMachine7!=c&&this.$StateMachine7.exit(i),this.$StateMachine7=c,c.asap?(delete c.asap,this.$StateMachine2.enter&&this.$StateMachine2.enter(c),c.progress=a.ENTERED):(c.progress=a.PENDING,c.asap=!0,c.$StateMachine8=b("setTimeoutAcrossTransitions")(function(){c.enter()},this.$StateMachine3)),this.emit(a.ENTER,c)};d.exit=function(a){this.exit_private(this.$StateMachine7,a)};d.exit_private=function(c,d){__p&&__p();this.$StateMachine6("exit "+c+", "+d+", "+this.$StateMachine7);if(!c||c!=this.$StateMachine7)throw new Error(b("ex")("Invalid state: %s, history: %s",c,this.$StateMachine4.join("|")));if(c.progress==a.EXITED)return;c.status=d;c.progress=a.EXITED;c.$StateMachine8&&(clearInterval(c.$StateMachine8),c.$StateMachine8=null);this.$StateMachine7=null;c&&this.$StateMachine2.exit&&this.$StateMachine2.exit(c);c.exited=!0;this.emit(a.EXIT,c);if(d!=i){var e=this.$StateMachine1[c.name];if(!e||!e[d])throw new Error(b("ex")("No exit for state:%s, status: %s",c.name,d));this.enter(e[d])}};return a}(b("EventEmitter"));j.ENTER="enter";j.EXIT="exit";j.NEW="new";j.PENDING="pending";j.ENTERED="entered";j.EXITED="exited";e.exports=j}),null);
__d("rand32",[],(function(a,b,c,d,e,f){function a(){return Math.floor(Math.random()*4294967295)}e.exports=a}),null);
__d("MChannelManager",["BanzaiODS","ChannelClientConfig","ChannelClientID","ChannelDefaults","ChannelEventEmitter","ChannelEventType","ChannelStateMap","ChatProxyConnectionState","Clock","FBLogger","LogHistory","MRequest","MURI","RTISession","StateMachine","URI","Visibility","gkx","rand32","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();var g,h="ok",i="error",j=6e4,k=null,l=null,m=null,n=null,o=null,p=-1,q=null,r=0,s=b("ChannelClientID").getID(),t=!1,u={enter:function(a){__p&&__p();n&&(n.abort(),n=null);switch(a.name){case"pull":if(!l.uri)break;if(l.disabled)break;var c=new(b("URI"))(l.uri),d={channel:l.user_channel,seq:m,clientid:s,profile:"mobile",partition:l.partition,sticky_token:p,msgs_recv:r,qp:"y",cb:b("rand32")()};p==-1&&l.msgr_region&&(d.msgr_region=l.msgr_region);l.chat_enabled&&(d.state="active");q&&(d.sticky_pool=q);l.uid&&l.viewerUid&&(d.uid=l.uid,d.viewer_uid=l.viewerUid);l.state.aiq&&(d.aiq=l.state.aiq);n=new(b("MRequest"))(c+"").setCORS(!0).setMethod("GET").setData(d).setRaw(!0);n.listen("open",function(a){a.getTransport().withCredentials=!0});n.listen("done",function(b){y(a,b)});n.listen("error",function(){y(a)});break;case"reconnect":c=new(b("MURI"))("/a/channel/reconnect.php");n=new(b("MRequest"))(c+"").setMethod("GET");n.listen("done",function(b){w(a,b)});n.listen("error",function(b){b.isHandled=!0,w(a)});break;default:}n&&n.send()},exit:function(a){if(a.status==="ok")a.name==="pull"&&g.setDelay(0);else if(!(a.status==null)){a=g.getDelay();a=a>0?a*2:k.MIN_RETRY_INTERVAL;a=Math.min(a,k.MAX_RETRY_INTERVAL);g.setDelay(a)}n&&(n.abort(),n=null)}};function v(){var a=null;t&&l&&l.host&&p&&l.uid&&(a=new(b("RTISession"))(l.host,null,q,p,l.uid,l.viewerUid,"mobile",s,0));b("ChannelEventEmitter").emit(b("ChannelEventType").RTI_SESSION,a)}function c(a){o=a}function w(a,c){!c?(b("FBLogger")("FIXME").warn("_onReconnectError: reconnect request error"),a.exit(i)):c.user_channel?(l=c,l.state=new(b("ChatProxyConnectionState"))(),m=l.seq,a.exit(h)):(b("FBLogger")("FIXME").warn("_onReconnectError: bad reconnect response - %s",JSON.stringify(c)),a.exit(i))}function x(){t=!0,v()}function y(a,c){__p&&__p();var d=h;if(!c){a.exit(i);return}switch(c.t){case"refresh":case"refreshDelay":d="refresh_"+(c.reason||0);break;case"fullReload":d=h;c.seq==0&&x();"ms"in c&&z(c);break;case"continue":break;case"lb":var e=c.lb_info;if(e){p=e.sticky;var f="http://";l.is_secure_uri&&(f="https://");"pool"in e?q=e.pool:(l.uri=f+e.vip+".facebook.com/pull",l.host=e.vip)}else b("FBLogger")("FIXME").mustfix("bad lb info from channel proxy");break;case"msg":z(c);break;case"batched":f=c.batches;for(e=0;e<f.length;e++)y(a,f[e]);break;case"heartbeat":break;default:d=i;b("FBLogger")("FIXME").warn("_onRequestSuccess: invalid channel response, sending request again.");break}"seq"in c&&(m=c.seq);a.exit(d)}function z(a){__p&&__p();var c=a.seq-a.ms.length;for(var d=0;d<a.ms.length;d++){b("BanzaiODS").bumpEntityKey("ChannelManager","messageReceive.m."+a.ms[d].type);var e=c+d;r++;if(e>=m){o&&(a.ms[d]=o(a.ms[d]));try{if(a.ms[d].type==="skywalker")b("ChannelEventEmitter").emit(b("ChannelEventType").SKYWALKER_MESSAGE,a.ms[d]);else if(a.ms[d].type==="qprimer")x();else if(a.ms[d].type==="privacy_changed"){e=a.ms[d].data;e.visiblity!==void 0&&e.visibility!==null&&(l.chat_enabled=e.visibility)}else g.emit(g.CHANNEL_MESSAGE,a.ms[d])}catch(a){b("FBLogger")("FIXME").warn("_processMessages: failed to emit message")}}}}function d(){__p&&__p();if(!g.xhrEnabled||k)return;k=Object.assign(b("ChannelDefaults"),b("ChannelClientConfig").config);l=b("ChannelClientConfig").info;l.state=new(b("ChatProxyConnectionState"))();m=l.seq;b("Clock").addListener(b("Clock").ANOMALY,function(){g.exit("clock_anomaly")});b("Visibility").addListener(b("Visibility").HIDDEN,function(){g.exit("hidden")});b("Visibility").addListener(b("Visibility").VISIBLE,function(){g.exit("visible")});a.onbeforeunload=function(){n&&n.abort()};"sticky_token"in l&&(p=l.sticky_token);B()}function f(a,b){l.state.subscribeIrisQueue(a,b)}function A(a){l.state.subscribeIrisQueue(a)}function B(){g.setDelay(k.MIN_RETRY_INTERVAL),g.enter(l.uri?"pull!":"reconnect!")}g=new(b("StateMachine"))(b("ChannelStateMap"),u);g.startChannel=d;g.setTransform=c;g.xhrEnabled=!!a.XMLHttpRequest;g.CHANNEL_MESSAGE="channel_message";g.subscribeIrisQueue=f;g.unsubscribeIrisQueue=A;var C;function D(){g.emit(b("StateMachine").ENTER,{name:"stall",progress:b("StateMachine").ENTERED}),B()}function E(a){b("LogHistory").getInstance("channel").log(a.name,a.status||a.progress),a.name!=="stall"&&(clearTimeout(C),C=b("setTimeoutAcrossTransitions")(D,j))}g.addListener(b("StateMachine").ENTER,E);g.addListener(b("StateMachine").EXIT,E);b("ChannelEventEmitter").addListener(b("ChannelEventType").GET_RTI_SESSION_REQUEST,v);e.exports=g}),null);
__d("MTouchChannelManager",["Bootloader","MChannelManager","Run","gkx","onAfterDisplay","qex"],(function(a,b,c,d,e,f){__p&&__p();var g=!1;function a(a){a===void 0&&(a=!1);if(g)return;g=!0;b("MChannelManager").addListener(b("MChannelManager").CHANNEL_MESSAGE,function(a){return b("Bootloader").loadModules(["MTouchChannelPayloadRouter"],function(b){return b.route(a)},"MTouchChannelManager")});!a&&b("gkx")("676783")?b("gkx")("842146")||b("qex")._("828151")?b("Run").onAfterLoad(b("MChannelManager").startChannel):b("onAfterDisplay")(b("MChannelManager").startChannel):b("MChannelManager").startChannel()}f.initialize=a}),null);
__d("MPresenceIcon",["DOM","MLegacyDataStore","MRequest","MURI","Stratcom","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();var g=0,h=1,i=2,j;function k(){__p&&__p();var a=b("DOM").scry(document.body,"i","presence-icon"),c=[];for(var d=0,e=a.length;d<e;++d){var f=b("MLegacyDataStore").get(a[d]);f.userid&&!c[f.userid]&&(c[f.userid]=1)}f=new(b("MURI"))("/chat/presence_icon.php").toString();d=new(b("MRequest"))(f).setData({ids:Object.keys(c)}).setIgnoreErrors(!0);d.listen("done",function(e){for(var c=0,d=a.length;c<d;++c){var f=b("MLegacyDataStore").get(a[c]);f&&f.userid&&b("Stratcom").hasSigil(a[c],"online-icon")&&e[f.userid]==h||b("Stratcom").hasSigil(a[c],"mobile-icon")&&e[f.userid]==i?b("DOM").show(a[c]):b("DOM").hide(a[c])}});d.listen("finally",function(a){clearTimeout(j),j=b("setTimeoutAcrossTransitions")(k,g)});d.send()}g=g?g*100:6e4;k()}),null);
__d("MessagingEvent",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MARK_ALL_READ:"mark_all_read",MARK_ALL_SEEN:"mark_all_seen",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"})}),null);
__d("MJewelThreads",["Bootloader","ChannelEventType","MessagingEvent","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){this.$1=a,this.$2=[],this.$3=!1,this.$4=!1,b("Stratcom").listen(b("ChannelEventType").MESSAGE,null,this.onMessageEvent.bind(this))}var c=a.prototype;c.getThreads=function(){return this.$2};c.registerListeners=function(){b("Stratcom").listen("click","live-threads",this.onThreadClick.bind(this)),b("Stratcom").listen("m:jewel:flyout:open",null,this.onJewelOpen.bind(this))};c.onJewelOpen=function(a){a=a.getData();a=a&&a.jewel&&a.jewel==="messages";a&&this.$4&&this.updateUI()};c.onThreadClick=function(a){a=a.getNode("live-thread");if(!a)return;this.setThreadReadStatus(a.getAttribute("data-fbid"),a.getAttribute("data-canonical")==="true",!0);this.updateUI()};c.onMessageEvent=function(a){__p&&__p();var c=this,d=a.getData();if(d.parsedPayload){a=d.parsedPayload;if(a.getFolder()!=="inbox")return;this.$3||(this.$3=!0,this.registerListeners());this.addThread(a)}else if(Object.prototype.hasOwnProperty.call(d,"mark_as_read"))d.other_user_fbids.forEach(function(a){c.setThreadReadStatus(a.toString(),!0,d.mark_as_read)}),d.thread_fbids.forEach(function(a){c.setThreadReadStatus(a.toString(),!1,d.mark_as_read)}),this.updateUI();else if(d.event===b("MessagingEvent").READ&&d.is_sync){a=!!d.message.other_user_fbid;var e=a?d.message.other_user_fbid:d.message.thread_fbid;this.setThreadReadStatus(e,a,!0);this.updateUI()}};c.addThread=function(a){var b=this;this.$2=this.$2.filter(function(c){c=c.isCanonicalThread()?c.getOtherUserFBID():c.getThreadFBID();return!b.isSameThread(c,a.isCanonicalThread(),a)});a.unread=a.isUnread();this.$2.push(a);this.$4=!0;this.updateThreadImage(a)};c.updateThreadImage=function(a){var c=this;b("Bootloader").loadModules(["MMessagesThreadMetadataCache","MShortProfiles"],function(b,d){if(a.hasThreadImage())b.get(a.getThreadFBID(),function(b){a.image_src=b.image_src,c.updateUI()});else{b=a.isCanonicalThread()?a.getOtherUserFBID():a.getAuthorFBID();d.get(b,function(b){a.image_src=b.mThumbSrcSmall,c.updateUI()})}},"MJewelThreads")};c.setThreadReadStatus=function(a,b,c){var d=this;this.$2.forEach(function(e){d.isSameThread(a,b,e)&&(e.unread==c&&(d.$4=!0),e.unread=!c)})};c.isSameThread=function(a,b,c){b=b?c.getOtherUserFBID():c.getThreadFBID();return a==b};c.updateUI=function(){__p&&__p();var a=this;if(!this.$3||!this.$4)return;b("Bootloader").loadModules(["React","ReactDOM","MJewelThreadList.react","Popover"],function(b,c,d,e){if(!e.getInstance("messages_flyout").isOpen())return;var f={threads:a.$2};c.render(b.createElement(d,f),a.$1);e.getInstance("messages_flyout").refreshConstraints();a.$4=!1},"MJewelThreads")};return a}();e.exports=a}),null);
__d("MMessagesThreadRowID",[],(function(a,b,c,d,e,f){"use strict";var g="other_user_fbid_",h="thread_fbid_";function a(a,b,c){return a+(b?g+b:h+String(c))}e.exports={getThreadRowID:a}}),null);
__d("MobileZeroRewriteURL",["BanzaiLogger","MChannelManager"],(function(a,b,c,d,e,f){__p&&__p();var g=null,h=null;function a(a){__p&&__p();if(!a)return;g=a.regex_matcher;h=a.regex_replacer;for(var a=0;a<g.length;a++){var c=g[a];c.indexOf("^")===0&&(c=c.substr(1));c=new RegExp(c,"i");g[a]=c}b("MChannelManager").setTransform(i)}function i(a){if(!g)return a;j(a);return a}function j(a){if(!a)return;if(Array.isArray(a))for(var b=0;b<a.length;b++)k(a,b);else for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&k(a,c)}function k(a,c){__p&&__p();var d=a[c],e=typeof d;e==="object"?j(d):e==="string"&&d.indexOf("<img")>=0&&(d=d.replace(/<img[^>]*>/gi,function(a){for(var c=0;c<g.length;c++){var d=g[c],e=h[c],f=a.replace(d,e);if(d.test(a)){b("BanzaiLogger").log("ZeroImgRewriteLoggerConfig",{matcher:d,replacer:e,rewrite_url:f,url:a});return f}}return a}),a[c]=d)}f.main=a}),null);